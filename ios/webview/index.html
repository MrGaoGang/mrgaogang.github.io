<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>高先生的博客</title>
    <meta name="description" content="旨在分享对技术的了解">
    <link rel="icon" href="/icons/icon.png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?9cfd884fe46fc31072811d47a486a552";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
    
    <link rel="preload" href="/assets/css/0.styles.8164cbfa.css" as="style"><link rel="preload" href="/assets/js/app.41067249.js" as="script"><link rel="preload" href="/assets/js/5.49ac7986.js" as="script"><link rel="preload" href="/assets/js/3.c83a9e42.js" as="script"><link rel="preload" href="/assets/js/28.dd0fb4c2.js" as="script"><link rel="prefetch" href="/assets/js/1.02e40fdf.js"><link rel="prefetch" href="/assets/js/10.1e8266d3.js"><link rel="prefetch" href="/assets/js/100.9dce2fe9.js"><link rel="prefetch" href="/assets/js/101.403ba413.js"><link rel="prefetch" href="/assets/js/102.0ea28425.js"><link rel="prefetch" href="/assets/js/103.f950b1c3.js"><link rel="prefetch" href="/assets/js/104.afa755af.js"><link rel="prefetch" href="/assets/js/105.c68e72e2.js"><link rel="prefetch" href="/assets/js/106.7d783635.js"><link rel="prefetch" href="/assets/js/107.1d966f23.js"><link rel="prefetch" href="/assets/js/108.acf1aa56.js"><link rel="prefetch" href="/assets/js/109.61cb8342.js"><link rel="prefetch" href="/assets/js/11.a411b8c7.js"><link rel="prefetch" href="/assets/js/110.4a58668f.js"><link rel="prefetch" href="/assets/js/111.2884e3dc.js"><link rel="prefetch" href="/assets/js/112.9a090b19.js"><link rel="prefetch" href="/assets/js/113.afa0740f.js"><link rel="prefetch" href="/assets/js/114.d82f1328.js"><link rel="prefetch" href="/assets/js/115.1e02db7d.js"><link rel="prefetch" href="/assets/js/116.58dd10cc.js"><link rel="prefetch" href="/assets/js/117.1230ec65.js"><link rel="prefetch" href="/assets/js/118.ea5fe55e.js"><link rel="prefetch" href="/assets/js/119.7e4d9c86.js"><link rel="prefetch" href="/assets/js/12.7aeb7d8b.js"><link rel="prefetch" href="/assets/js/120.b50ce194.js"><link rel="prefetch" href="/assets/js/121.f361ffba.js"><link rel="prefetch" href="/assets/js/122.2598f008.js"><link rel="prefetch" href="/assets/js/123.a0a00e0e.js"><link rel="prefetch" href="/assets/js/124.7f265ca2.js"><link rel="prefetch" href="/assets/js/125.5a06a31b.js"><link rel="prefetch" href="/assets/js/126.0748a5aa.js"><link rel="prefetch" href="/assets/js/127.d29bf692.js"><link rel="prefetch" href="/assets/js/128.9410dbb6.js"><link rel="prefetch" href="/assets/js/129.bd87e496.js"><link rel="prefetch" href="/assets/js/13.e9ee8cac.js"><link rel="prefetch" href="/assets/js/130.025c7ba2.js"><link rel="prefetch" href="/assets/js/131.6b973e71.js"><link rel="prefetch" href="/assets/js/132.1c90fbb6.js"><link rel="prefetch" href="/assets/js/133.2c6859b8.js"><link rel="prefetch" href="/assets/js/134.a189852a.js"><link rel="prefetch" href="/assets/js/135.8195ce91.js"><link rel="prefetch" href="/assets/js/136.625fb975.js"><link rel="prefetch" href="/assets/js/137.5eb366e2.js"><link rel="prefetch" href="/assets/js/138.194089bf.js"><link rel="prefetch" href="/assets/js/139.cbfc68bd.js"><link rel="prefetch" href="/assets/js/14.8d97b7c1.js"><link rel="prefetch" href="/assets/js/140.45d05d58.js"><link rel="prefetch" href="/assets/js/141.4c28939b.js"><link rel="prefetch" href="/assets/js/142.663f9da3.js"><link rel="prefetch" href="/assets/js/143.da04adec.js"><link rel="prefetch" href="/assets/js/144.806d8fe3.js"><link rel="prefetch" href="/assets/js/145.77932cfc.js"><link rel="prefetch" href="/assets/js/146.bdd87071.js"><link rel="prefetch" href="/assets/js/147.71710cc3.js"><link rel="prefetch" href="/assets/js/148.48aeca5d.js"><link rel="prefetch" href="/assets/js/149.85c9af98.js"><link rel="prefetch" href="/assets/js/15.916213e5.js"><link rel="prefetch" href="/assets/js/150.148efff8.js"><link rel="prefetch" href="/assets/js/151.103e2871.js"><link rel="prefetch" href="/assets/js/152.ac1fed4e.js"><link rel="prefetch" href="/assets/js/153.d036e165.js"><link rel="prefetch" href="/assets/js/154.a5908a61.js"><link rel="prefetch" href="/assets/js/155.414f2c5d.js"><link rel="prefetch" href="/assets/js/156.e77c5113.js"><link rel="prefetch" href="/assets/js/157.9bad2c2d.js"><link rel="prefetch" href="/assets/js/158.04e704f8.js"><link rel="prefetch" href="/assets/js/159.cc68d75d.js"><link rel="prefetch" href="/assets/js/16.77d8b6d3.js"><link rel="prefetch" href="/assets/js/160.b2a21450.js"><link rel="prefetch" href="/assets/js/161.5f91a848.js"><link rel="prefetch" href="/assets/js/162.9a16e2fa.js"><link rel="prefetch" href="/assets/js/163.cc158a46.js"><link rel="prefetch" href="/assets/js/164.f6bbe094.js"><link rel="prefetch" href="/assets/js/165.66ab2d0d.js"><link rel="prefetch" href="/assets/js/166.1f9ea12f.js"><link rel="prefetch" href="/assets/js/167.208d9498.js"><link rel="prefetch" href="/assets/js/168.9be3a57b.js"><link rel="prefetch" href="/assets/js/169.6d12da00.js"><link rel="prefetch" href="/assets/js/17.2d89c1ad.js"><link rel="prefetch" href="/assets/js/18.e9fba40c.js"><link rel="prefetch" href="/assets/js/19.44e715ca.js"><link rel="prefetch" href="/assets/js/2.7636f56d.js"><link rel="prefetch" href="/assets/js/20.879bdf9c.js"><link rel="prefetch" href="/assets/js/21.05408205.js"><link rel="prefetch" href="/assets/js/22.ffb89f14.js"><link rel="prefetch" href="/assets/js/23.3fb279be.js"><link rel="prefetch" href="/assets/js/24.8f5d6d52.js"><link rel="prefetch" href="/assets/js/25.a9498604.js"><link rel="prefetch" href="/assets/js/26.a0b4bf9e.js"><link rel="prefetch" href="/assets/js/27.2e3d7bf0.js"><link rel="prefetch" href="/assets/js/29.bde3c907.js"><link rel="prefetch" href="/assets/js/30.7f6582fd.js"><link rel="prefetch" href="/assets/js/31.2f73cb95.js"><link rel="prefetch" href="/assets/js/32.ad8d2044.js"><link rel="prefetch" href="/assets/js/33.c14e35e5.js"><link rel="prefetch" href="/assets/js/34.0fde8ba6.js"><link rel="prefetch" href="/assets/js/35.ba1dee5c.js"><link rel="prefetch" href="/assets/js/36.51ee6d61.js"><link rel="prefetch" href="/assets/js/37.015c685e.js"><link rel="prefetch" href="/assets/js/38.57ed3002.js"><link rel="prefetch" href="/assets/js/39.875e01bb.js"><link rel="prefetch" href="/assets/js/40.720eaf89.js"><link rel="prefetch" href="/assets/js/41.a8e36e09.js"><link rel="prefetch" href="/assets/js/42.bb887473.js"><link rel="prefetch" href="/assets/js/43.208b2bd4.js"><link rel="prefetch" href="/assets/js/44.469e1e46.js"><link rel="prefetch" href="/assets/js/45.c9ac4261.js"><link rel="prefetch" href="/assets/js/46.58ce0f10.js"><link rel="prefetch" href="/assets/js/47.4d6861ae.js"><link rel="prefetch" href="/assets/js/48.82ef8f18.js"><link rel="prefetch" href="/assets/js/49.e350daf3.js"><link rel="prefetch" href="/assets/js/50.9fa515b8.js"><link rel="prefetch" href="/assets/js/51.91e2a374.js"><link rel="prefetch" href="/assets/js/52.83e3c4df.js"><link rel="prefetch" href="/assets/js/53.4dc6ea77.js"><link rel="prefetch" href="/assets/js/54.0cd58c60.js"><link rel="prefetch" href="/assets/js/55.7884ad17.js"><link rel="prefetch" href="/assets/js/56.f722e889.js"><link rel="prefetch" href="/assets/js/57.38df2724.js"><link rel="prefetch" href="/assets/js/58.38c630ad.js"><link rel="prefetch" href="/assets/js/59.0e54ff7e.js"><link rel="prefetch" href="/assets/js/6.ec8e2322.js"><link rel="prefetch" href="/assets/js/60.ae553e2e.js"><link rel="prefetch" href="/assets/js/61.25d00070.js"><link rel="prefetch" href="/assets/js/62.b459b0ea.js"><link rel="prefetch" href="/assets/js/63.52dc00c2.js"><link rel="prefetch" href="/assets/js/64.ef5e08b3.js"><link rel="prefetch" href="/assets/js/65.68f0aae1.js"><link rel="prefetch" href="/assets/js/66.94180d06.js"><link rel="prefetch" href="/assets/js/67.4927ad63.js"><link rel="prefetch" href="/assets/js/68.833ec0d7.js"><link rel="prefetch" href="/assets/js/69.bc852310.js"><link rel="prefetch" href="/assets/js/7.f2fb179e.js"><link rel="prefetch" href="/assets/js/70.58367678.js"><link rel="prefetch" href="/assets/js/71.e6365f6d.js"><link rel="prefetch" href="/assets/js/72.0d567d34.js"><link rel="prefetch" href="/assets/js/73.d3ff291c.js"><link rel="prefetch" href="/assets/js/74.96bf1c7f.js"><link rel="prefetch" href="/assets/js/75.c3fcd3e3.js"><link rel="prefetch" href="/assets/js/76.1eda7ff0.js"><link rel="prefetch" href="/assets/js/77.5b52f5ee.js"><link rel="prefetch" href="/assets/js/78.29cd0b94.js"><link rel="prefetch" href="/assets/js/79.6074aba6.js"><link rel="prefetch" href="/assets/js/8.01e92a67.js"><link rel="prefetch" href="/assets/js/80.6a9d200c.js"><link rel="prefetch" href="/assets/js/81.f5c9f90e.js"><link rel="prefetch" href="/assets/js/82.695e2419.js"><link rel="prefetch" href="/assets/js/83.abcbf5b8.js"><link rel="prefetch" href="/assets/js/84.eed62881.js"><link rel="prefetch" href="/assets/js/85.7239e9a3.js"><link rel="prefetch" href="/assets/js/86.dc60ad80.js"><link rel="prefetch" href="/assets/js/87.2418f619.js"><link rel="prefetch" href="/assets/js/88.22ac89ee.js"><link rel="prefetch" href="/assets/js/89.3f66a9b7.js"><link rel="prefetch" href="/assets/js/9.a95120b0.js"><link rel="prefetch" href="/assets/js/90.14f864f3.js"><link rel="prefetch" href="/assets/js/91.3b6f998d.js"><link rel="prefetch" href="/assets/js/92.c16e0990.js"><link rel="prefetch" href="/assets/js/93.a0b37916.js"><link rel="prefetch" href="/assets/js/94.35daccad.js"><link rel="prefetch" href="/assets/js/95.16f9adf2.js"><link rel="prefetch" href="/assets/js/96.baabcef4.js"><link rel="prefetch" href="/assets/js/97.781cf1c6.js"><link rel="prefetch" href="/assets/js/98.e8cde142.js"><link rel="prefetch" href="/assets/js/99.b05339e2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8164cbfa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/header.png" alt="高先生的博客" class="logo"> <span class="site-name can-hide">高先生的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="http://gaogangsever.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  页面构建器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/javascript/index.html" class="nav-link">前端</a></div><div class="nav-item"><a href="/vue/index.html" class="nav-link">Vue</a></div><div class="nav-item"><a href="/react/index.html" class="nav-link">React/RN</a></div><div class="nav-item"><a href="/ai/index.html" class="nav-link">AI</a></div><div class="nav-item"><a href="/android/index.html" class="nav-link">Android</a></div><div class="nav-item"><a href="/ios/index.html" class="nav-link">iOS</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">低代码Mendix</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mendix/index.html" class="nav-link">1. Mendix介绍</a></li><li class="dropdown-item"><!----> <a href="/mendix/widgets/index.html" class="nav-link">2. 组件开发</a></li><li class="dropdown-item"><!----> <a href="/mendix/study.html" class="nav-link">3. Mendix学习</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/linux.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/other/git.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/other/vscode.html" class="nav-link">vscode</a></li><li class="dropdown-item"><!----> <a href="https://yeasy.gitbook.io/docker_practice/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  docker
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">开源</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/article/oview/index.html" class="nav-link">图表库oView</a></li><li class="dropdown-item"><!----> <a href="https://github.com/MrGaoGang/luckly_recyclerview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  lucky_recyclerview
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/MrGaoGang/luckly_popup_window" target="_blank" rel="noopener noreferrer" class="nav-link external">
  lucky_popup_window
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/MrGaoGang/lucky_tools/blob/master/packages/mendix-cli/README.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue开发Mendix组件脚手架
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/MrGaoGang/cocos-webpack-web" target="_blank" rel="noopener noreferrer" class="nav-link external">
  cocos web端开发
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/MrGaoGang/ui-designer" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ui 构建器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/MrGaoGang/KotlinGank" target="_blank" rel="noopener noreferrer" class="nav-link external">
  kotlin App
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/MrGaoGang/tensorflow_object_detection" target="_blank" rel="noopener noreferrer" class="nav-link external">
  tensorflow object detection
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/MrGaoGang/mrgaogang.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="http://gaogangsever.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  页面构建器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/javascript/index.html" class="nav-link">前端</a></div><div class="nav-item"><a href="/vue/index.html" class="nav-link">Vue</a></div><div class="nav-item"><a href="/react/index.html" class="nav-link">React/RN</a></div><div class="nav-item"><a href="/ai/index.html" class="nav-link">AI</a></div><div class="nav-item"><a href="/android/index.html" class="nav-link">Android</a></div><div class="nav-item"><a href="/ios/index.html" class="nav-link">iOS</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">低代码Mendix</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/mendix/index.html" class="nav-link">1. Mendix介绍</a></li><li class="dropdown-item"><!----> <a href="/mendix/widgets/index.html" class="nav-link">2. 组件开发</a></li><li class="dropdown-item"><!----> <a href="/mendix/study.html" class="nav-link">3. Mendix学习</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/linux.html" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/other/git.html" class="nav-link">Git</a></li><li class="dropdown-item"><!----> <a href="/other/vscode.html" class="nav-link">vscode</a></li><li class="dropdown-item"><!----> <a href="https://yeasy.gitbook.io/docker_practice/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  docker
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">开源</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/article/oview/index.html" class="nav-link">图表库oView</a></li><li class="dropdown-item"><!----> <a href="https://github.com/MrGaoGang/luckly_recyclerview" target="_blank" rel="noopener noreferrer" class="nav-link external">
  lucky_recyclerview
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/MrGaoGang/luckly_popup_window" target="_blank" rel="noopener noreferrer" class="nav-link external">
  lucky_popup_window
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/MrGaoGang/lucky_tools/blob/master/packages/mendix-cli/README.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue开发Mendix组件脚手架
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/MrGaoGang/cocos-webpack-web" target="_blank" rel="noopener noreferrer" class="nav-link external">
  cocos web端开发
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/MrGaoGang/ui-designer" target="_blank" rel="noopener noreferrer" class="nav-link external">
  ui 构建器
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/MrGaoGang/KotlinGank" target="_blank" rel="noopener noreferrer" class="nav-link external">
  kotlin App
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/MrGaoGang/tensorflow_object_detection" target="_blank" rel="noopener noreferrer" class="nav-link external">
  tensorflow object detection
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/MrGaoGang/mrgaogang.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ios/webview/#一、wkwebview-的-14-个类和-3-个协议" class="sidebar-link">一、WKWebView 的 14 个类和 3 个协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ios/webview/#_1-wkwebview-的-14-个类" class="sidebar-link">1. WKWebView 的 14 个类</a></li><li class="sidebar-sub-header"><a href="/ios/webview/#_3-wkwebview-的三个协议【重点】" class="sidebar-link">3. WKWebView 的三个协议【重点】</a></li></ul></li><li><a href="/ios/webview/#二、wkwebview-的-api" class="sidebar-link">二、WKWebView 的 API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ios/webview/#_1-wkwebview-的初始化" class="sidebar-link">1. WKWebView 的初始化</a></li><li class="sidebar-sub-header"><a href="/ios/webview/#_2-wkwebview-加载-html-的方式" class="sidebar-link">2. WKWebView 加载 HTML 的方式</a></li><li class="sidebar-sub-header"><a href="/ios/webview/#_3-其他主要-api" class="sidebar-link">3. 其他主要 API</a></li></ul></li><li><a href="/ios/webview/#三、wkwebview-和-js-交互" class="sidebar-link">三、WKWebView 和 JS 交互</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ios/webview/#_1-js-调用-oc-程序" class="sidebar-link">1. JS 调用 OC 程序</a></li><li class="sidebar-sub-header"><a href="/ios/webview/#_2-oc-调用-js-方法" class="sidebar-link">2. OC 调用 JS 方法</a></li><li class="sidebar-sub-header"><a href="/ios/webview/#_3-oc-和-js-数据类型映射" class="sidebar-link">3. OC 和 JS 数据类型映射</a></li></ul></li><li><a href="/ios/webview/#四、wkwebview-的问题" class="sidebar-link">四、WKWebView 的问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ios/webview/#_1-wkwebview-首次加载-cookie-不成功的问题" class="sidebar-link">1. WKWebView 首次加载 Cookie 不成功的问题</a></li><li class="sidebar-sub-header"><a href="/ios/webview/#_2-ajax-请求-cookie-丢失的问题" class="sidebar-link">2. ajax 请求 cookie 丢失的问题</a></li><li class="sidebar-sub-header"><a href="/ios/webview/#_3-跳转页面-cookie-丢失问题" class="sidebar-link">3. 跳转页面 cookie 丢失问题</a></li><li class="sidebar-sub-header"><a href="/ios/webview/#_4-其他问题" class="sidebar-link">4. 其他问题</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>导语: 很少会有一个 App 完全使用原生代码去编写，更多的情况是原生和 H5 结合的方式，本文主要介绍一下在 iOS 中如何使用 WKWebView 及和 JS 的交互。</p></blockquote> <p>在 iOS8.0 之前我们使用的是 <code>UIWebView</code>，但是由于其性能问题在 iOS8.0 之后苹果官方推出了 <code>WKWebView</code>，具有<code>高性能</code>，<code>占用更少的内存</code>，<code>支持更多 H5 的特性</code>等优点。</p> <p>要对 WKWebView 有更多的了解，首先必须清楚其有<code>14个类和3个协议</code>；只有掌握了<code>14个类和3个协议</code>才能更好的应用 WebView。</p> <h2 id="一、wkwebview-的-14-个类和-3-个协议"><a href="#一、wkwebview-的-14-个类和-3-个协议" aria-hidden="true" class="header-anchor">#</a> 一、WKWebView 的 14 个类和 3 个协议</h2> <h3 id="_1-wkwebview-的-14-个类"><a href="#_1-wkwebview-的-14-个类" aria-hidden="true" class="header-anchor">#</a> 1. WKWebView 的 14 个类</h3> <p>我们不一定会完全使用到如下的 14 个类，也不一定现在完全了解他们具体的使用方法；但是我们需要首先了解每个类的具体作用，用以开发过程中能够快速的找到。</p> <ul><li><code>WKScriptMessageHandler</code>: 提供从网页中收消息的回调方法</li> <li><code>WKWebViewConfiguration</code>: 初始化 webview 的设置。</li> <li><code>WKBackForwardList</code>: 之前访问过的 web 页面的列表，可以通过后退和前进动作来访问到。</li> <li><code>WKBackForwardListItem</code>: webview 中后退列表里的某一个网页。</li> <li><code>WKFrameInfo</code>: 包含一个网页的布局信息。</li> <li><code>WKNavigation</code>: 包含一个网页的加载进度信息。</li> <li><code>WKNavigationAction</code>: 包含可能让网页导航变化的信息，用于判断是否做出导航变化。</li> <li><code>WKNavigationResponse</code>: 包含可能让网页导航变化的返回内容信息，用于判断是否做出导航变化。</li> <li><code>WKPreferences</code>: 概括一个 webview 的偏好设置。</li> <li><code>WKProcessPool</code>: 表示一个 web 内容加载池。</li> <li><code>WKUserContentController</code>: 提供使用 JavaScript post 信息和注册 script 的方法。</li> <li><code>WKScriptMessage</code>: 包含网页发出的信息。</li> <li><code>WKUserScript</code>: 表示可以被网页接受的用户脚本。</li> <li><code>WKWindowFeatures</code>: 指定加载新网页时的窗口属性。</li> <li><code>WKWebsiteDataStore</code>: 包含网页数据存储和查找。</li> <li><code>WKNavigationDelegate</code>: 提供了追踪主窗口网页加载过程和判断主窗口和子窗口是否进行页面加载新页面的相关方法。</li> <li><code>WKUIDelegate</code>: 提供用原生控件显示网页的方法回调。</li></ul> <h3 id="_3-wkwebview-的三个协议【重点】"><a href="#_3-wkwebview-的三个协议【重点】" aria-hidden="true" class="header-anchor">#</a> 3. WKWebView 的三个协议【重点】</h3> <p>相比上面的 14 个类，如下的三个协议更为重要，且必须知道如何使用；只有这样你才能实现 iOS 和 JS 的交互。</p> <h4 id="_1-wknavigationdelegate"><a href="#_1-wknavigationdelegate" aria-hidden="true" class="header-anchor">#</a> 1). WKNavigationDelegate</h4> <blockquote><p>该代理提供的方法，可以用来追踪加载过程（页面开始加载、加载完成、加载失败）、以及决定是否执行跳转。</p></blockquote> <p><strong>页面加载相关方法</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 页面开始加载时调用</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebView</span> <span class="token operator">*</span><span class="token punctuation">)</span>webView didStartProvisionalNavigation<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKNavigation</span> <span class="token operator">*</span><span class="token punctuation">)</span>navigation<span class="token punctuation">;</span>
<span class="token comment">// 当内容开始返回时调用</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebView</span> <span class="token operator">*</span><span class="token punctuation">)</span>webView didCommitNavigation<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKNavigation</span> <span class="token operator">*</span><span class="token punctuation">)</span>navigation<span class="token punctuation">;</span>
<span class="token comment">// 页面加载完成之后调用</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebView</span> <span class="token operator">*</span><span class="token punctuation">)</span>webView didFinishNavigation<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKNavigation</span> <span class="token operator">*</span><span class="token punctuation">)</span>navigation<span class="token punctuation">;</span>
<span class="token comment">// 页面加载失败时调用</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebView</span> <span class="token operator">*</span><span class="token punctuation">)</span>webView didFailProvisionalNavigation<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKNavigation</span> <span class="token operator">*</span><span class="token punctuation">)</span>navigation<span class="token punctuation">;</span>
</code></pre></div><p><strong>页面跳转相关方法</strong></p> <blockquote><p>页面跳转的代理方法有三种，分为（收到跳转与决定是否跳转两种）</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 接收到服务器跳转请求之后调用</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebView</span> <span class="token operator">*</span><span class="token punctuation">)</span>webView didReceiveServerRedirectForProvisionalNavigation<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKNavigation</span> <span class="token operator">*</span><span class="token punctuation">)</span>navigation<span class="token punctuation">;</span>
<span class="token comment">// 在收到响应后，决定是否跳转</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebView</span> <span class="token operator">*</span><span class="token punctuation">)</span>webView decidePolicyForNavigationResponse<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKNavigationResponse</span> <span class="token operator">*</span><span class="token punctuation">)</span>navigationResponse decisionHandler<span class="token operator">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">WKNavigationResponsePolicy</span><span class="token punctuation">)</span><span class="token punctuation">)</span>decisionHandler<span class="token punctuation">;</span>
<span class="token comment">// 在发送请求之前，决定是否跳转</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebView</span> <span class="token operator">*</span><span class="token punctuation">)</span>webView decidePolicyForNavigationAction<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKNavigationAction</span> <span class="token operator">*</span><span class="token punctuation">)</span>navigationAction decisionHandler<span class="token operator">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">WKNavigationActionPolicy</span><span class="token punctuation">)</span><span class="token punctuation">)</span>decisionHandler<span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-wkscriptmessagehandler"><a href="#_2-wkscriptmessagehandler" aria-hidden="true" class="header-anchor">#</a> 2). WKScriptMessageHandler</h4> <p><code>WKScriptMessageHandler</code>应该说是最重要的一个协议了，因为 js 调用 OC 代码就是通过此协议中的方法传递过来的。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 从web界面中接收到一个脚本时调用</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>userContentController<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKUserContentController</span> <span class="token operator">*</span><span class="token punctuation">)</span>userContentController didReceiveScriptMessage<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKScriptMessage</span> <span class="token operator">*</span><span class="token punctuation">)</span>message<span class="token punctuation">;</span>

</code></pre></div><p>我们可以通过<code>message.name</code>获取到 js 中挂在到 window 下的方法。</p> <p>一个简单例子:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>userContentController<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKUserContentController</span> <span class="token operator">*</span><span class="token punctuation">)</span>userContentController didReceiveScriptMessage<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKScriptMessage</span> <span class="token operator">*</span><span class="token punctuation">)</span>message<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>message<span class="token punctuation">.</span>name isEqualToString<span class="token operator">:</span>@<span class="token string">&quot;windowMethod&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 实现你的需求</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-wkuidelegate"><a href="#_3-wkuidelegate" aria-hidden="true" class="header-anchor">#</a> 3). WKUIDelegate</h4> <p><code>WKUIDelegate</code>所实现的代理方法都是与界面弹出提示框相关的，针对于 web 界面的三种提示框（警告框、确认框、输入框）分别对应三种代理方法。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 新建WKWebView</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable <span class="token class-name">WKWebView</span> <span class="token operator">*</span><span class="token punctuation">)</span>webView<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebView</span> <span class="token operator">*</span><span class="token punctuation">)</span>webView createWebViewWithConfiguration<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebViewConfiguration</span> <span class="token operator">*</span><span class="token punctuation">)</span>configuration forNavigationAction<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKNavigationAction</span> <span class="token operator">*</span><span class="token punctuation">)</span>navigationAction windowFeatures<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWindowFeatures</span> <span class="token operator">*</span><span class="token punctuation">)</span>windowFeatures<span class="token punctuation">;</span>

<span class="token comment">// 关闭WKWebView</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webViewDidClose<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebView</span> <span class="token operator">*</span><span class="token punctuation">)</span>webView <span class="token function">NS_AVAILABLE</span><span class="token punctuation">(</span><span class="token number">10_11</span><span class="token punctuation">,</span> <span class="token number">9_0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 对应js的Alert方法</span>
<span class="token comment">/**
 *  web界面中有弹出警告框时调用
 *
 *  @param webView           实现该代理的webview
 *  @param message           警告框中的内容
 *  @param frame             主窗口
 *  @param completionHandler 警告框消失调用
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebView</span> <span class="token operator">*</span><span class="token punctuation">)</span>webView runJavaScriptAlertPanelWithMessage<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token punctuation">)</span>message initiatedByFrame<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKFrameInfo</span> <span class="token operator">*</span><span class="token punctuation">)</span>frame completionHandler<span class="token operator">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span>completionHandler<span class="token punctuation">;</span>

<span class="token comment">// 对应js的confirm方法</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebView</span> <span class="token operator">*</span><span class="token punctuation">)</span>webView runJavaScriptConfirmPanelWithMessage<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token punctuation">)</span>message initiatedByFrame<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKFrameInfo</span> <span class="token operator">*</span><span class="token punctuation">)</span>frame completionHandler<span class="token operator">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">BOOL</span> result<span class="token punctuation">)</span><span class="token punctuation">)</span>completionHandler<span class="token punctuation">;</span>

<span class="token comment">// 对应js的prompt方法</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebView</span> <span class="token operator">*</span><span class="token punctuation">)</span>webView runJavaScriptTextInputPanelWithPrompt<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token punctuation">)</span>prompt defaultText<span class="token operator">:</span><span class="token punctuation">(</span>nullable <span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token punctuation">)</span>defaultText initiatedByFrame<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKFrameInfo</span> <span class="token operator">*</span><span class="token punctuation">)</span>frame completionHandler<span class="token operator">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span> __nullable result<span class="token punctuation">)</span><span class="token punctuation">)</span>completionHandler<span class="token punctuation">;</span>


</code></pre></div><h2 id="二、wkwebview-的-api"><a href="#二、wkwebview-的-api" aria-hidden="true" class="header-anchor">#</a> 二、WKWebView 的 API</h2> <h3 id="_1-wkwebview-的初始化"><a href="#_1-wkwebview-的初始化" aria-hidden="true" class="header-anchor">#</a> 1. WKWebView 的初始化</h3> <p>WKWebView 的初始化方法一共有两种:</p> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token comment">// 默认初始化</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>initWithFrame<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">CGRect</span><span class="token punctuation">)</span>frame<span class="token punctuation">;</span>

<span class="token comment">// 根据对webview的相关配置，进行初始化,configuration就是上面说的偏好设置</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>initWithFrame<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">CGRect</span><span class="token punctuation">)</span>frame configuration<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebViewConfiguration</span> <span class="token operator">*</span><span class="token punctuation">)</span>configuration NS_DESIGNATED_INITIALIZER<span class="token punctuation">;</span>


</code></pre></div><h3 id="_2-wkwebview-加载-html-的方式"><a href="#_2-wkwebview-加载-html-的方式" aria-hidden="true" class="header-anchor">#</a> 2. WKWebView 加载 HTML 的方式</h3> <p>如果你看过前面的一篇文章，如何加载 pdf/excel/word 文档，你会发现 webview 有一个<code>loadRequest</code>方法可以直接请求对应的 url 地址：</p> <p><strong>基本方法</strong></p> <div class="language-java extra-class"><pre class="language-java"><code>NSURL <span class="token operator">*</span>url <span class="token operator">=</span> <span class="token punctuation">[</span>NSURL <span class="token class-name">URLWithString</span><span class="token operator">:</span>@<span class="token string">&quot;mrgaogang.github.com&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name">NSURLRequest</span> <span class="token operator">*</span>request <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">NSURLRequest</span> requestWithURL<span class="token operator">:</span>url<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>webView loadRequest<span class="token operator">:</span>request<span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre></div><p><strong>其他方法</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//加载本地URL文件</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable <span class="token class-name">WKNavigation</span> <span class="token operator">*</span><span class="token punctuation">)</span>loadFileURL<span class="token operator">:</span><span class="token punctuation">(</span>NSURL <span class="token operator">*</span><span class="token punctuation">)</span>URL
allowingReadAccessToURL<span class="token operator">:</span><span class="token punctuation">(</span>NSURL <span class="token operator">*</span><span class="token punctuation">)</span>readAccessURL

<span class="token comment">//加载本地HTML字符串</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable <span class="token class-name">WKNavigation</span> <span class="token operator">*</span><span class="token punctuation">)</span>loadHTMLString<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token punctuation">)</span>string  baseURL<span class="token operator">:</span><span class="token punctuation">(</span>nullable NSURL <span class="token operator">*</span><span class="token punctuation">)</span>baseURL<span class="token punctuation">;</span>
<span class="token comment">//加载二进制数据</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable <span class="token class-name">WKNavigation</span> <span class="token operator">*</span><span class="token punctuation">)</span>loadData<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">NSData</span> <span class="token operator">*</span><span class="token punctuation">)</span>data <span class="token class-name">MIMEType</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token class-name">MIMEType</span> characterEncodingName<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token punctuation">)</span>characterEncodingName baseURL<span class="token operator">:</span><span class="token punctuation">(</span>NSURL <span class="token operator">*</span><span class="token punctuation">)</span>baseURL

</code></pre></div><h3 id="_3-其他主要-api"><a href="#_3-其他主要-api" aria-hidden="true" class="header-anchor">#</a> 3. 其他主要 API</h3> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token comment">//上文介绍过的偏好配置</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> <span class="token class-name">WKWebViewConfiguration</span> <span class="token operator">*</span>configuration<span class="token punctuation">;</span>
<span class="token comment">// 导航代理</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> nonatomic<span class="token punctuation">,</span> weak<span class="token punctuation">)</span> id <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WKNavigationDelegate</span><span class="token punctuation">&gt;</span></span> navigationDelegate<span class="token punctuation">;</span>
<span class="token comment">// 用户交互代理</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> nonatomic<span class="token punctuation">,</span> weak<span class="token punctuation">)</span> id <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WKUIDelegate</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">UIDelegate</span><span class="token punctuation">;</span>

<span class="token comment">// 页面前进、后退列表</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token class-name">WKBackForwardList</span> <span class="token operator">*</span>backForwardList<span class="token punctuation">;</span>

<span class="token comment">// 默认构造器</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>initWithFrame<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">CGRect</span><span class="token punctuation">)</span>frame configuration<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebViewConfiguration</span> <span class="token operator">*</span><span class="token punctuation">)</span>configuration NS_DESIGNATED_INITIALIZER<span class="token punctuation">;</span>


<span class="token comment">//加载请求API</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable <span class="token class-name">WKNavigation</span> <span class="token operator">*</span><span class="token punctuation">)</span>loadRequest<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">NSURLRequest</span> <span class="token operator">*</span><span class="token punctuation">)</span>request<span class="token punctuation">;</span>

<span class="token comment">// 加载URL</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable <span class="token class-name">WKNavigation</span> <span class="token operator">*</span><span class="token punctuation">)</span>loadFileURL<span class="token operator">:</span><span class="token punctuation">(</span>NSURL <span class="token operator">*</span><span class="token punctuation">)</span>URL allowingReadAccessToURL<span class="token operator">:</span><span class="token punctuation">(</span>NSURL <span class="token operator">*</span><span class="token punctuation">)</span>readAccessURL <span class="token function">NS_AVAILABLE</span><span class="token punctuation">(</span><span class="token number">10_11</span><span class="token punctuation">,</span> <span class="token number">9_0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 直接加载HTML</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable <span class="token class-name">WKNavigation</span> <span class="token operator">*</span><span class="token punctuation">)</span>loadHTMLString<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token punctuation">)</span>string baseURL<span class="token operator">:</span><span class="token punctuation">(</span>nullable NSURL <span class="token operator">*</span><span class="token punctuation">)</span>baseURL<span class="token punctuation">;</span>

<span class="token comment">// 直接加载二进制data</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable <span class="token class-name">WKNavigation</span> <span class="token operator">*</span><span class="token punctuation">)</span>loadData<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">NSData</span> <span class="token operator">*</span><span class="token punctuation">)</span>data <span class="token class-name">MIMEType</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token class-name">MIMEType</span> characterEncodingName<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token punctuation">)</span>characterEncodingName baseURL<span class="token operator">:</span><span class="token punctuation">(</span>NSURL <span class="token operator">*</span><span class="token punctuation">)</span>baseURL <span class="token function">NS_AVAILABLE</span><span class="token punctuation">(</span><span class="token number">10_11</span><span class="token punctuation">,</span> <span class="token number">9_0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 前进或者后退到某一页面</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable <span class="token class-name">WKNavigation</span> <span class="token operator">*</span><span class="token punctuation">)</span>goToBackForwardListItem<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKBackForwardListItem</span> <span class="token operator">*</span><span class="token punctuation">)</span>item<span class="token punctuation">;</span>

<span class="token comment">// 页面的标题，支持KVO的</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> <span class="token class-name">NSString</span> <span class="token operator">*</span>title<span class="token punctuation">;</span>

<span class="token comment">// 当前请求的URL，支持KVO的</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> NSURL <span class="token operator">*</span>URL<span class="token punctuation">;</span>

<span class="token comment">// 标识当前是否正在加载内容中，支持KVO的</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> getter<span class="token operator">=</span>isLoading<span class="token punctuation">)</span> <span class="token class-name">BOOL</span> loading<span class="token punctuation">;</span>

<span class="token comment">// 当前加载的进度，范围为[0, 1]</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">)</span> <span class="token keyword">double</span> estimatedProgress<span class="token punctuation">;</span>

<span class="token comment">// 标识页面中的所有资源是否通过安全加密连接来加载，支持KVO的</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">)</span> <span class="token class-name">BOOL</span> hasOnlySecureContent<span class="token punctuation">;</span>

<span class="token comment">// 当前导航的证书链，支持KVO</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> <span class="token class-name">NSArray</span> <span class="token operator">*</span>certificateChain <span class="token function">NS_AVAILABLE</span><span class="token punctuation">(</span><span class="token number">10_11</span><span class="token punctuation">,</span> <span class="token number">9_0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 是否可以招待goback操作，它是支持KVO的</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">)</span> <span class="token class-name">BOOL</span> canGoBack<span class="token punctuation">;</span>

<span class="token comment">// 是否可以执行gofarward操作，支持KVO</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">)</span> <span class="token class-name">BOOL</span> canGoForward<span class="token punctuation">;</span>

<span class="token comment">// 返回上一页面，如果不能返回，则什么也不干</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable <span class="token class-name">WKNavigation</span> <span class="token operator">*</span><span class="token punctuation">)</span>goBack<span class="token punctuation">;</span>

<span class="token comment">// 进入下一页面，如果不能前进，则什么也不干</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable <span class="token class-name">WKNavigation</span> <span class="token operator">*</span><span class="token punctuation">)</span>goForward<span class="token punctuation">;</span>

<span class="token comment">// 重新载入页面</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable <span class="token class-name">WKNavigation</span> <span class="token operator">*</span><span class="token punctuation">)</span>reload<span class="token punctuation">;</span>

<span class="token comment">// 重新从原始URL载入</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>nullable <span class="token class-name">WKNavigation</span> <span class="token operator">*</span><span class="token punctuation">)</span>reloadFromOrigin<span class="token punctuation">;</span>

<span class="token comment">// 停止加载数据</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>stopLoading<span class="token punctuation">;</span>

<span class="token comment">// 执行JS代码</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>evaluateJavaScript<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token punctuation">)</span>javaScriptString completionHandler<span class="token operator">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span> __nullable<span class="token punctuation">)</span><span class="token punctuation">(</span>__nullable id<span class="token punctuation">,</span> <span class="token class-name">NSError</span> <span class="token operator">*</span> __nullable error<span class="token punctuation">)</span><span class="token punctuation">)</span>completionHandler<span class="token punctuation">;</span>

<span class="token comment">// 标识是否支持左、右swipe手势是否可以前进、后退</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">)</span> <span class="token class-name">BOOL</span> allowsBackForwardNavigationGestures<span class="token punctuation">;</span>

<span class="token comment">// 自定义user agent，如果没有则为nil</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nullable<span class="token punctuation">,</span> nonatomic<span class="token punctuation">,</span> copy<span class="token punctuation">)</span> <span class="token class-name">NSString</span> <span class="token operator">*</span>customUserAgent <span class="token function">NS_AVAILABLE</span><span class="token punctuation">(</span><span class="token number">10_11</span><span class="token punctuation">,</span> <span class="token number">9_0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在iOS上默认为NO，标识不允许链接预览</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">)</span> BOOL allowsLinkPreview <span class="token function">NS_AVAILABLE</span><span class="token punctuation">(</span><span class="token number">10_11</span><span class="token punctuation">,</span> <span class="token number">9_0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

#<span class="token keyword">if</span> TARGET_OS_IPHONE
<span class="token comment">/*! @abstract The scroll view associated with the web view.
 */</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> <span class="token class-name">UIScrollView</span> <span class="token operator">*</span>scrollView<span class="token punctuation">;</span>
#endif

#<span class="token keyword">if</span> <span class="token operator">!</span>TARGET_OS_IPHONE
<span class="token comment">// 标识是否支持放大手势，默认为NO</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">)</span> <span class="token class-name">BOOL</span> allowsMagnification<span class="token punctuation">;</span>

<span class="token comment">// 放大因子，默认为1</span>
<span class="token annotation punctuation">@property</span> <span class="token punctuation">(</span>nonatomic<span class="token punctuation">)</span> <span class="token class-name">CGFloat</span> magnification<span class="token punctuation">;</span>

<span class="token comment">// 根据设置的缩放因子来缩放页面，并居中显示结果在指定的点</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>setMagnification<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">CGFloat</span><span class="token punctuation">)</span>magnification centeredAtPoint<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">CGPoint</span><span class="token punctuation">)</span>point<span class="token punctuation">;</span>


</code></pre></div><h2 id="三、wkwebview-和-js-交互"><a href="#三、wkwebview-和-js-交互" aria-hidden="true" class="header-anchor">#</a> 三、WKWebView 和 JS 交互</h2> <p>现在我们正式的简单介绍 WKWebView 是如何和 JS 进行交互的；使用过 jsbridge 或者写过 Android 的 webview 和 js 交互的同学都清楚，所谓的 oc 能调用 js 的代码 需要 js 的函数挂在到 window 下面才行。</p> <p>先看效果图:</p> <p><img src="/assets/img/webview.36e659ce.png" alt=""></p> <h3 id="_1-js-调用-oc-程序"><a href="#_1-js-调用-oc-程序" aria-hidden="true" class="header-anchor">#</a> 1. JS 调用 OC 程序</h3> <p>js 调用 OC 程序一共需要实现如下几个步骤:</p> <ul><li>编写 html 并使用<code>window.webkit.messageHandlers.方法名称.postMessage();</code>调用 oc</li></ul> <ul><li><p>初始化 WKWebView 配置 WKWebViewConfiguration,并设置可执行 js 代码；</p></li> <li><p>初始化 WKWebView</p></li> <li><p>注册所有需要调用的方法</p></li> <li><p>WKWebView 加载 html</p></li></ul> <p><strong>第一步: 编写 html 并使用<code>window.webkit.messageHandlers.方法名称.postMessage();</code>调用 oc</strong></p> <p>注意点:</p> <ul><li>postMessage 的参数不能为空什么都不写(至少也要写一个 null)，不然不会走代理方法</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token comment">// oc调用js代码</span>
      <span class="token keyword">function</span> <span class="token function">ocToH51</span><span class="token punctuation">(</span><span class="token parameter">params<span class="token punctuation">,</span> params2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span>
          params <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span> <span class="token operator">+</span> params2<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">function</span> <span class="token function">h5ToOC1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在OC中可以通过message.name isEqualsString h5ToOC1来获取到此处调用的参数</span>
        window<span class="token punctuation">.</span>webkit<span class="token punctuation">.</span>messageHandlers<span class="token punctuation">.</span>h5ToOC1<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>
          <span class="token string">&quot;我是h5传递过来的一个参数&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">function</span> <span class="token function">h5ToOC2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在OC中可以通过message.name isEqualsString h5ToOC2来获取到此处调用的参数</span>
        window<span class="token punctuation">.</span>webkit<span class="token punctuation">.</span>messageHandlers<span class="token punctuation">.</span>h5ToOC2<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
          <span class="token string">&quot;我是h5传递过来的一个参数&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;我是第二个参数&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
      <span class="token selector">.container</span> <span class="token punctuation">{</span>
        <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
        <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token selector">.container button</span> <span class="token punctuation">{</span>
        <span class="token property">margin-top</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
        <span class="token property">background-color</span><span class="token punctuation">:</span> dodgerblue<span class="token punctuation">;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
        <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
        <span class="token property">border</span><span class="token punctuation">:</span> 1px solid white<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>我是H5页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>h5ToOC1()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>传递单个参数给iOS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>h5ToOC2()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>传递多个参数给iOS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>如下是oc传递给H5的数据<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>data<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>第二步：初始化 WKWebViewConfiguration 并设置可执行 JS;</strong></p> <div class="language-java extra-class"><pre class="language-java"><code>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>viewDidLoad <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> viewDidLoad<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// Do any additional setup after loading the view.</span>
    <span class="token comment">// 初始化WKWebViewConfiguration并设置可执行JS;</span>
    <span class="token class-name">WKWebViewConfiguration</span> <span class="token operator">*</span>config <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">WKWebViewConfiguration</span> alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 默认为0</span>
    config<span class="token punctuation">.</span>preferences<span class="token punctuation">.</span>minimumFontSize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token comment">//是否支持JavaScript</span>
    config<span class="token punctuation">.</span>preferences<span class="token punctuation">.</span>javaScriptEnabled <span class="token operator">=</span> YES<span class="token punctuation">;</span>
    <span class="token comment">//不通过用户交互，是否可以打开窗口</span>
    config<span class="token punctuation">.</span>preferences<span class="token punctuation">.</span>javaScriptCanOpenWindowsAutomatically <span class="token operator">=</span> NO<span class="token punctuation">;</span>

    <span class="token class-name">CGSize</span> size<span class="token operator">=</span>  <span class="token class-name">UIScreen</span><span class="token punctuation">.</span>mainScreen<span class="token punctuation">.</span>bounds<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
    <span class="token comment">// 初始化webview</span>
    self<span class="token punctuation">.</span>webView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">WKWebView</span> alloc<span class="token punctuation">]</span> initWithFrame<span class="token operator">:</span><span class="token class-name">CGRectMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> size<span class="token punctuation">.</span>width<span class="token punctuation">,</span> size<span class="token punctuation">.</span>height<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span> configuration<span class="token operator">:</span>config<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// JS调用OC代码，需要在OC端先注册有哪些方法，这样才能在WKScriptMessageHandler的协议方法实现</span>
    <span class="token punctuation">[</span>self registerJSCallOCMethod<span class="token operator">:</span>config<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 使用webview加载url</span>
    <span class="token punctuation">[</span>self loadHTML<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token punctuation">[</span>self<span class="token punctuation">.</span>view addSubview<span class="token operator">:</span>self<span class="token punctuation">.</span>webView<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token comment">/**
 使用webview加载url
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> loadHTML<span class="token punctuation">{</span>

<span class="token comment">//    加载本地的地址</span>
<span class="token comment">//    NSString *html = [NSBundle.mainBundle pathForResource:@&quot;index&quot; ofType:@&quot;html&quot;];</span>
<span class="token comment">//    NSURL *url = [[NSBundle mainBundle] bundleURL];</span>
<span class="token comment">//    [self.webView loadHTMLString:[NSString stringWithContentsOfFile: html encoding:NSUTF8StringEncoding error:nil]  baseURL: url ];</span>

    <span class="token comment">// 加载远程的URL,10.66.147.65请换成自己本地的ip地址</span>
    NSURL <span class="token operator">*</span>url <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>NSURL alloc<span class="token punctuation">]</span> initWithString<span class="token operator">:</span>@<span class="token string">&quot;http://10.66.147.65:3000&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">NSURLRequest</span> <span class="token operator">*</span>request <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">NSURLRequest</span> alloc<span class="token punctuation">]</span> initWithURL<span class="token operator">:</span>url<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>self<span class="token punctuation">.</span>webView loadRequest<span class="token operator">:</span>request<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// JS调用OC代码，需要在OC端先注册有哪些方法，这样才能在WKScriptMessageHandler的协议方法实现</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> registerJSCallOCMethod<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">WKWebViewConfiguration</span> <span class="token operator">*</span><span class="token punctuation">)</span> config<span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>config<span class="token operator">!=</span>nil<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 获取到WKUserContentController，通过WKUserContentController注册方法</span>
        <span class="token class-name">WKUserContentController</span> <span class="token operator">*</span>controller <span class="token operator">=</span> config<span class="token punctuation">.</span>userContentController<span class="token punctuation">;</span>
        <span class="token punctuation">[</span>controller addScriptMessageHandler<span class="token operator">:</span>self name<span class="token operator">:</span>@<span class="token string">&quot;h5ToOC1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>controller addScriptMessageHandler<span class="token operator">:</span>self name<span class="token operator">:</span>@<span class="token string">&quot;h5ToOC2&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p><strong>注意点: 使用完成之后需要释放 WKUserContentController，不然会造成内存泄漏</strong></p> <blockquote><p>泄漏的原因: 我们最开始 使用<code>[controller addScriptMessageHandler:self name:@&quot;h5ToOC1&quot;]</code>注册了方法中<code>controller</code>持有了<code>self</code>,然后 <code>controller</code> 又被<code>config</code>持有，最终被<code>webview</code>持有，然后 <code>webview</code> 是 <code>self</code> 的一个私有变量，所以 <code>self</code> 也持有 <code>self</code>，所以，这个时候<code>有循环引用的问题存在</code>，导致界面被 pop 或者 dismiss 之后依然会存在内存中。不会被释放;</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 注意，必须在dealloc方法调用的时候处理，释放资源</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>dealloc<span class="token punctuation">{</span>
    <span class="token class-name">WKUserContentController</span> <span class="token operator">*</span>container <span class="token operator">=</span> self<span class="token punctuation">.</span>webView<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span>userContentController<span class="token punctuation">;</span>
    <span class="token punctuation">[</span>container removeScriptMessageHandlerForName<span class="token operator">:</span>@<span class="token string">&quot;h5ToOC1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>container removeScriptMessageHandlerForName<span class="token operator">:</span>@<span class="token string">&quot;h5ToOC2&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-oc-调用-js-方法"><a href="#_2-oc-调用-js-方法" aria-hidden="true" class="header-anchor">#</a> 2. OC 调用 JS 方法</h3> <p>OC 必须调用挂在到 window 下的 JS 方法，且主要使用<code>evaluateJavaScript</code>去执行 js:</p> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token class-name">IBAction</span><span class="token punctuation">)</span>ocToH5<span class="token operator">:</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>sender <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>self<span class="token punctuation">.</span>webView evaluateJavaScript<span class="token operator">:</span>@<span class="token string">&quot;ocToH51('你好，mrgaogang','mrgaogang.github.io')&quot;</span> completionHandler<span class="token operator">:</span><span class="token operator">^</span><span class="token punctuation">(</span>id _Nullable response<span class="token punctuation">,</span> <span class="token class-name">NSError</span> <span class="token operator">*</span> _Nullable error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//JS 返回结果</span>
        <span class="token class-name">NSLog</span><span class="token punctuation">(</span>@<span class="token string">&quot;%@ %@&quot;</span><span class="token punctuation">,</span>response<span class="token punctuation">,</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-oc-和-js-数据类型映射"><a href="#_3-oc-和-js-数据类型映射" aria-hidden="true" class="header-anchor">#</a> 3. OC 和 JS 数据类型映射</h3> <p>不管是 js 传递给 OC 还是 OC 调用 JS,我们需要清除 OC 和 JS 数据类型，以便能够使用适合的数据结构获取数据。</p> <p><img src="/assets/img/data-types.64d2e0c5.png" alt=""></p> <h2 id="四、wkwebview-的问题"><a href="#四、wkwebview-的问题" aria-hidden="true" class="header-anchor">#</a> 四、WKWebView 的问题</h2> <p>加载 Cookie 的时候的几个注意事项</p> <ul><li>WKWebView 加载网页得到的 Cookie 会同步到 NSHTTPCookieStorage 中。</li> <li>WKWebView 加载请求时，不会同步 NSHTTPCookieStorage 中已有的 Cookie。</li> <li>通过共用一个 WKProcessPool 并不能解决 2 中 Cookie 同步问题，且可能会造成 Cookie 丢失。</li></ul> <h3 id="_1-wkwebview-首次加载-cookie-不成功的问题"><a href="#_1-wkwebview-首次加载-cookie-不成功的问题" aria-hidden="true" class="header-anchor">#</a> 1. WKWebView 首次加载 Cookie 不成功的问题</h3> <blockquote><p>在请求头中添加 cookie，这样的话只要保证[NSHTTPCookieStorage sharedHTTPCookieStorage]中存在你的 cookie，第一次请求就不会有问题了</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">NSMutableURLRequest</span> <span class="token operator">*</span>request <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">NSMutableURLRequest</span> requestWithURL<span class="token operator">:</span><span class="token punctuation">[</span>NSURL <span class="token class-name">URLWithString</span><span class="token operator">:</span>@<span class="token string">&quot;http://www.LynkCo.com&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name">NSArray</span> <span class="token operator">*</span>cookies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">NSHTTPCookieStorage</span> sharedHTTPCookieStorage<span class="token punctuation">]</span><span class="token punctuation">.</span>cookies<span class="token punctuation">;</span>
<span class="token comment">//Cookies数组转换为requestHeaderFields</span>
<span class="token class-name">NSDictionary</span> <span class="token operator">*</span>requestHeaderFields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">NSHTTPCookie</span> requestHeaderFieldsWithCookies<span class="token operator">:</span>cookies<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//设置请求头</span>
request<span class="token punctuation">.</span>allHTTPHeaderFields <span class="token operator">=</span> requestHeaderFields<span class="token punctuation">;</span>
<span class="token punctuation">[</span>self<span class="token punctuation">.</span>webView loadRequest<span class="token operator">:</span>request<span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="_2-ajax-请求-cookie-丢失的问题"><a href="#_2-ajax-请求-cookie-丢失的问题" aria-hidden="true" class="header-anchor">#</a> 2. ajax 请求 cookie 丢失的问题</h3> <blockquote><p>只需要通过添加 WKUserScript 就可以了，只要保证 sharedHTTPCookieStorage 中你的 Cookie 存在，后续 Ajax 请求就不会有问题。</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token comment">/*!
 *  更新webView的cookie
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>updateWebViewCookie
<span class="token punctuation">{</span>
    <span class="token class-name">WKUserScript</span> <span class="token operator">*</span> cookieScript <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">WKUserScript</span> alloc<span class="token punctuation">]</span> initWithSource<span class="token operator">:</span><span class="token punctuation">[</span>self cookieString<span class="token punctuation">]</span> injectionTime<span class="token operator">:</span><span class="token class-name">WKUserScriptInjectionTimeAtDocumentStart</span> forMainFrameOnly<span class="token operator">:</span>NO<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//添加Cookie</span>
    <span class="token punctuation">[</span>self<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span>userContentController addUserScript<span class="token operator">:</span>cookieScript<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token class-name">NSString</span> <span class="token operator">*</span><span class="token punctuation">)</span>cookieString
<span class="token punctuation">{</span>
    <span class="token class-name">NSMutableString</span> <span class="token operator">*</span>script <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">NSMutableString</span> string<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>script appendString<span class="token operator">:</span>@<span class="token string">&quot;var cookieNames = document.cookie.split('; ').map(function(cookie) { return cookie.split('=')[0] } );\n&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">NSHTTPCookie</span> <span class="token operator">*</span>cookie in <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token class-name">NSHTTPCookieStorage</span> sharedHTTPCookieStorage<span class="token punctuation">]</span> cookies<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Skip cookies that will break our script</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>cookie<span class="token punctuation">.</span>value rangeOfString<span class="token operator">:</span>@<span class="token string">&quot;'&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>location <span class="token operator">!=</span> <span class="token class-name">NSNotFound</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Create a line that appends this cookie to the web view's document's cookies</span>
        <span class="token punctuation">[</span>script appendFormat<span class="token operator">:</span>@<span class="token string">&quot;if (cookieNames.indexOf('%@') == -1) { document.cookie='%@'; };\n&quot;</span><span class="token punctuation">,</span> cookie<span class="token punctuation">.</span>name<span class="token punctuation">,</span> cookie<span class="token punctuation">.</span>da_javascriptString<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> script<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_3-跳转页面-cookie-丢失问题"><a href="#_3-跳转页面-cookie-丢失问题" aria-hidden="true" class="header-anchor">#</a> 3. 跳转页面 cookie 丢失问题</h3> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token comment">//核心方法：</span>
<span class="token comment">/**
 修复打开链接Cookie丢失问题

 @param request 请求
 @return 一个fixedRequest
 */</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token class-name">NSURLRequest</span> <span class="token operator">*</span><span class="token punctuation">)</span>fixRequest<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">NSURLRequest</span> <span class="token operator">*</span><span class="token punctuation">)</span>request
<span class="token punctuation">{</span>
    <span class="token class-name">NSMutableURLRequest</span> <span class="token operator">*</span>fixedRequest<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>request isKindOfClass<span class="token operator">:</span><span class="token punctuation">[</span><span class="token class-name">NSMutableURLRequest</span> <span class="token keyword">class</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fixedRequest <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">NSMutableURLRequest</span> <span class="token operator">*</span><span class="token punctuation">)</span>request<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        fixedRequest <span class="token operator">=</span> request<span class="token punctuation">.</span>mutableCopy<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//防止Cookie丢失</span>
    <span class="token class-name">NSDictionary</span> <span class="token operator">*</span>dict <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">NSHTTPCookie</span> requestHeaderFieldsWithCookies<span class="token operator">:</span><span class="token punctuation">[</span><span class="token class-name">NSHTTPCookieStorage</span> sharedHTTPCookieStorage<span class="token punctuation">]</span><span class="token punctuation">.</span>cookies<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dict<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">NSMutableDictionary</span> <span class="token operator">*</span>mDict <span class="token operator">=</span> request<span class="token punctuation">.</span>allHTTPHeaderFields<span class="token punctuation">.</span>mutableCopy<span class="token punctuation">;</span>
        <span class="token punctuation">[</span>mDict setValuesForKeysWithDictionary<span class="token operator">:</span>dict<span class="token punctuation">]</span><span class="token punctuation">;</span>
        fixedRequest<span class="token punctuation">.</span>allHTTPHeaderFields <span class="token operator">=</span> mDict<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> fixedRequest<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

#pragma mark <span class="token operator">-</span> <span class="token class-name">WKNavigationDelegate</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>webView<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebView</span> <span class="token operator">*</span><span class="token punctuation">)</span>webView decidePolicyForNavigationAction<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKNavigationAction</span> <span class="token operator">*</span><span class="token punctuation">)</span>navigationAction decisionHandler<span class="token operator">:</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">WKNavigationActionPolicy</span><span class="token punctuation">)</span><span class="token punctuation">)</span>decisionHandler <span class="token punctuation">{</span>

#warning important 这里很重要
    <span class="token comment">//解决Cookie丢失问题</span>
    <span class="token class-name">NSURLRequest</span> <span class="token operator">*</span>originalRequest <span class="token operator">=</span> navigationAction<span class="token punctuation">.</span>request<span class="token punctuation">;</span>
    <span class="token punctuation">[</span>self fixRequest<span class="token operator">:</span>originalRequest<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//如果originalRequest就是NSMutableURLRequest, originalRequest中已添加必要的Cookie，可以跳转</span>
    <span class="token comment">//允许跳转</span>
    <span class="token function">decisionHandler</span><span class="token punctuation">(</span><span class="token class-name">WKNavigationActionPolicyAllow</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//可能有小伙伴，会说如果originalRequest是NSURLRequest，不可变，那不就添加不了Cookie了，是的，我们不能因为这个问题，不允许跳转，也不能在不允许跳转之后用loadRequest加载fixedRequest，否则会出现死循环，具体的，小伙伴们可以用本地的html测试下。</span>

    <span class="token class-name">NSLog</span><span class="token punctuation">(</span>@<span class="token string">&quot;%@&quot;</span><span class="token punctuation">,</span> <span class="token class-name">NSStringFromSelector</span><span class="token punctuation">(</span>_cmd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

#pragma mark <span class="token operator">-</span> <span class="token class-name">WKUIDelegate</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token class-name">WKWebView</span> <span class="token operator">*</span><span class="token punctuation">)</span>webView<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebView</span> <span class="token operator">*</span><span class="token punctuation">)</span>webView createWebViewWithConfiguration<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWebViewConfiguration</span> <span class="token operator">*</span><span class="token punctuation">)</span>configuration forNavigationAction<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKNavigationAction</span> <span class="token operator">*</span><span class="token punctuation">)</span>navigationAction windowFeatures<span class="token operator">:</span><span class="token punctuation">(</span><span class="token class-name">WKWindowFeatures</span> <span class="token operator">*</span><span class="token punctuation">)</span>windowFeatures <span class="token punctuation">{</span>

#warning important 这里也很重要
    <span class="token comment">//这里不打开新窗口</span>
    <span class="token punctuation">[</span>self<span class="token punctuation">.</span>webView loadRequest<span class="token operator">:</span><span class="token punctuation">[</span>self fixRequest<span class="token operator">:</span>navigationAction<span class="token punctuation">.</span>request<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> nil<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_4-其他问题"><a href="#_4-其他问题" aria-hidden="true" class="header-anchor">#</a> 4. 其他问题</h3> <p><a href="https://mp.weixin.qq.com/s/rhYKLIbXOsUJC_n6dt9UfA" target="_blank" rel="noopener noreferrer">详情请见: WKWebView 那些坑<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>参考</strong></p> <ul><li><p><a href="https://www.jianshu.com/p/3a6b8bb902ce" target="_blank" rel="noopener noreferrer">iOS-WebView 详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://mp.weixin.qq.com/s/rhYKLIbXOsUJC_n6dt9UfA" target="_blank" rel="noopener noreferrer">WKWebView 那些坑<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://juejin.im/post/5d5148f2f265da03da2488d7#heading-16" target="_blank" rel="noopener noreferrer">WKWebView Cookie 问题<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">1/28/2021, 8:50:54 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.41067249.js" defer></script><script src="/assets/js/5.49ac7986.js" defer></script><script src="/assets/js/3.c83a9e42.js" defer></script><script src="/assets/js/28.dd0fb4c2.js" defer></script>
  </body>
</html>
