(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{120:function(t,a,s){t.exports=s.p+"assets/img/1.b0733922.png"},121:function(t,a,s){t.exports=s.p+"assets/img/2.be0fe453.png"},346:function(t,a,s){"use strict";s.r(a);var n=s(1),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("blockquote",[n("p",[t._v("小明同学已经有过 1 年的 Android 开发经验了，一直都是按照网上的各种教程开发 App，突然有一天同学告诉他，Android4.4 的手机打开他开发的 App 页面展示极其的慢;信誓旦旦的小明展开了一系列的排查，发现网络请求还 OK，数据处理也不耗时，最终排查到时因为自己为了布局在 xml 文件中各种添加 LinearLayout , FrameLayout , TableLayout 和 AbsoluteLayout 导致页面绘制缓慢；经过一系列的google，发现自己对于Android绘制层面的优化还有所欠缺；于是展开了一波学习。")])]),t._v(" "),n("h1",{attrs:{id:"android-性能优化之绘制优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#android-性能优化之绘制优化","aria-hidden":"true"}},[t._v("#")]),t._v(" Android 性能优化之绘制优化")]),t._v(" "),n("h2",{attrs:{id:"一、避免过度绘制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、避免过度绘制","aria-hidden":"true"}},[t._v("#")]),t._v(" 一、避免过度绘制")]),t._v(" "),n("p",[t._v("过度绘制（"),n("code",[t._v("OverDraw")]),t._v("）是指在屏幕上在某一个像素，子安同一帧的时间内被多次的绘制，常见的是重复被组件或者布局添加背景颜色，等等。\n主要原因：")]),t._v(" "),n("ul",[n("li",[t._v("XML 布局文件，控件有重叠且都有设置背景。")]),t._v(" "),n("li",[t._v("View 的自绘中，View.onDraw 里面同一个区域被多次绘制了。")])]),t._v(" "),n("h3",{attrs:{id:"（一）、过度绘制的检测工具"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#（一）、过度绘制的检测工具","aria-hidden":"true"}},[t._v("#")]),t._v(" （一）、过度绘制的检测工具")]),t._v(" "),n("p",[t._v("打开手机设置中开发者人员选项，选择打开“显示 GPU 过度重绘”，对没有默认开启硬件加速的界面需要同时打开“强制进行 GPU 渲染”。")]),t._v(" "),n("ul",[n("li",[t._v("无色：没有过度重绘， 每个像素只绘制一次")]),t._v(" "),n("li",[t._v("蓝色：每个像素多绘制了一次（可接受）")]),t._v(" "),n("li",[t._v("绿色：每个像素多绘制两次（可接受）")]),t._v(" "),n("li",[t._v("淡红：每个像素多绘制三次，一般来说这个区域不超过屏幕的 1/4 是可以接受的。")]),t._v(" "),n("li",[t._v("深红：每个像素被绘制四次或者更多。不可接受。")])]),t._v(" "),n("p",[t._v("目标："),n("strong",[t._v("减少红色，显示更多蓝色区域。")])]),t._v(" "),n("h3",{attrs:{id:"（二）、布局上的优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#（二）、布局上的优化","aria-hidden":"true"}},[t._v("#")]),t._v(" （二）、布局上的优化")]),t._v(" "),n("ul",[n("li",[t._v("移除 XML 中非必须的背景，或者根据条件设置")]),t._v(" "),n("li",[t._v("移除 window 的默认背景(在 setContentView 前面加上 this.getWindow().setBackgroundDrawable(null));")]),t._v(" "),n("li",[t._v("按需显示占位背景图片。")])]),t._v(" "),n("h3",{attrs:{id:"（三）、自定义-view-的优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#（三）、自定义-view-的优化","aria-hidden":"true"}},[t._v("#")]),t._v(" （三）、自定义 View 的优化")]),t._v(" "),n("p",[t._v("在 View 的自绘中，会存在 View 的过度重绘，比如多个组件重叠在一起，如果我们只绘制出它显示的部分就解决了过度重绘问题，假设多个组件都按照原本大小绘制的话，将会到底过度重绘。")]),t._v(" "),n("ul",[n("li",[t._v("在自定义 View 中可以使用"),n("code",[t._v("canvas.clipRect()")]),t._v("来帮助系统识别哪些可见的区域，这个方法指定一个矩形区域，只有在这个区域内才会被绘制，其他区域将不会被绘制。")]),t._v(" "),n("li",[t._v("使用"),n("code",[t._v("canvas.quickreject()")]),t._v("来判断是否没和某个矩形相交，从而跳过哪些非矩形区域内的绘制操作。")])]),t._v(" "),n("p",[t._v("在"),n("code",[t._v("RecyclerView")]),t._v("或者"),n("code",[t._v("ListView")]),t._v("或者其他容器控件中，"),n("code",[t._v("ItemView")]),t._v("如果比较复杂，建议实现成一个自绘"),n("code",[t._v("View")]),t._v("，这样会让滑动更加顺畅。")]),t._v(" "),n("p",[t._v("以一个四个卡片叠加咋自定义 View 为例子")]),t._v(" "),n("p",[n("img",{attrs:{src:s(120),alt:""}}),t._v(" "),n("img",{attrs:{src:s(121),alt:""}})]),t._v(" "),n("p",[t._v("在实际的开发中布局的层次很容易超过 10 层如果超过 15 层就要重视并准备重新做优化，20 层就必须要修改了，实在没办法的话，就需要将复杂的布局层级使用自绘控件来实现。")]),t._v(" "),n("h2",{attrs:{id:"二、布局优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、布局优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 二、布局优化")]),t._v(" "),n("h3",{attrs:{id:"（一）、减少层级"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#（一）、减少层级","aria-hidden":"true"}},[t._v("#")]),t._v(" （一）、减少层级")]),t._v(" "),n("p",[t._v("层级越少，测试和绘制的时间越短，通常减少层级的方法有")]),t._v(" "),n("ul",[n("li",[t._v("1、尽量使用 RelativeLayout 和 LinearLayout")]),t._v(" "),n("li",[t._v("2、在布局层级相同的情况下，使用 LinearLayout")]),t._v(" "),n("li",[t._v("3、使用 LinearLayout 有时候会让层级变得更多，所以应该使用 RelativeLayout，尽量使界面扁平化")])]),t._v(" "),n("p",[n("code",[t._v("RelativeLayout")]),t._v(" 存在性能低的问题，原因是 "),n("code",[t._v("RelativeLayout")]),t._v(" 会对子 "),n("code",[t._v("View")]),t._v(" 做两次测量，在 "),n("code",[t._v("RelativeLayout")]),t._v(" 中子 "),n("code",[t._v("View")]),t._v(" 的排列方式是基于彼此的依赖关系的。因为依赖关系可能和布局中 "),n("code",[t._v("View")]),t._v(" 的顺序不一样，在确定每一个子 "),n("code",[t._v("View")]),t._v(" 的位置时，需要先给所有的子 View 做一次排序，如果再 "),n("code",[t._v("RelativeLayout")]),t._v(" 中允许子 View 横向或者纵向相互依赖，就需要横向和纵向分别在进行一次测量。\n"),n("code",[t._v("LinearLayout")]),t._v(" 中有 "),n("code",[t._v("weight")]),t._v(" 属性，也需要做两次测量，因为没有更多的依赖关系，所以会比 "),n("code",[t._v("RelativeLayout")]),t._v(" 效率高。")]),t._v(" "),n("h3",{attrs:{id:"（二）、merge-的使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#（二）、merge-的使用","aria-hidden":"true"}},[t._v("#")]),t._v(" （二）、Merge 的使用")]),t._v(" "),n("h4",{attrs:{id:"主要使用场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主要使用场景","aria-hidden":"true"}},[t._v("#")]),t._v(" 主要使用场景")]),t._v(" "),n("p",[t._v("在使用 Merge 的场合主要有以下两处：")]),t._v(" "),n("ul",[n("li",[t._v("1、在自定义 "),n("code",[t._v("View")]),t._v(" 中使用，父元素尽量是 "),n("code",[t._v("FrameLayout")]),t._v(" 或者 "),n("code",[t._v("LinearLayout")])]),t._v(" "),n("li",[t._v("2、在 "),n("code",[t._v("Activity")]),t._v(" 中整体布局，根元素需要时 "),n("code",[t._v("FrameLayout。")]),t._v("\n- 在 "),n("code",[t._v("Android")]),t._v(" 布局的源码中，如果是 "),n("code",[t._v("Merge")]),t._v(" 标签，那么直接将其中的子元素添加到 "),n("code",[t._v("Merge")]),t._v(" 标签的 "),n("code",[t._v("Parent")]),t._v(" 中，这样就不会引入额外的层级了。\n- 如果 "),n("code",[t._v("Merge")]),t._v(" 代替的布局元素为 "),n("code",[t._v("LinearLayout")]),t._v("，在自定义布局代码中将 "),n("code",[t._v("LinearLayout")]),t._v(" 属性添加到引用上，如垂直和水平布局，背景色等。")])]),t._v(" "),n("h4",{attrs:{id:"注意事项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意事项","aria-hidden":"true"}},[t._v("#")]),t._v(" 注意事项")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("Merge")]),t._v(" 只能用在布局 "),n("code",[t._v("XML")]),t._v(" 文件的根元素。")]),t._v(" "),n("li",[t._v("使用 "),n("code",[t._v("Merge")]),t._v(" 来加载一个布局时，必须指定一个 ViewGroup 作为其父元素，并且要设置加载的 "),n("code",[t._v("attchToRoot")]),t._v(" 参数为 true(也就是 "),n("code",[t._v("inflate(int,ViewGroup,boolean))")])]),t._v(" "),n("li",[t._v("不能再 Viewstub 中使用 Merge 标签，原因是 ViewStub 的 inflate 方法中根本没有 attachToRoot 的设置")])]),t._v(" "),n("blockquote",[n("p",[t._v("在 "),n("code",[t._v("Activity")]),t._v(" 的总布局中使用 "),n("code",[t._v("Merge")]),t._v("，但又想设置整体的属性（比如布局方式和颜色），可以不使用 "),n("code",[t._v("setContentView")]),t._v(" 方法加载 "),n("code",[t._v("Layout")]),t._v(",而使用（id/content）将 "),n("code",[t._v("FrameLayout")]),t._v(" 取出。在代码中手动加载布局，但是如果层级压力不大（小于 10 级），则没有必要，因为代码的维护性就很差了。")])]),t._v(" "),n("h3",{attrs:{id:"（三）、提高显示速度使用-viewstub"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#（三）、提高显示速度使用-viewstub","aria-hidden":"true"}},[t._v("#")]),t._v(" （三）、提高显示速度使用 ViewStub")]),t._v(" "),n("p",[n("code",[t._v("ViewStub")]),t._v(" 是一个轻量级的 "),n("code",[t._v("View")]),t._v("，它是一个看不见的，并且不占用布局位置，占用资源非常小的视图对象，可以为 "),n("code",[t._v("ViewStub")]),t._v(" 指定一个布局，加载布局时，只有 "),n("code",[t._v("ViewStub")]),t._v(" 会被初始化，然后当 "),n("code",[t._v("ViewStub")]),t._v(" 被设置为可见的时候，或者是调用 "),n("code",[t._v("ViewStub,inflate()")]),t._v("时候，"),n("code",[t._v("ViewStub")]),t._v(" 所指向的布局就会加载和实例化，然后 Vi`ewStub 的布局属性就会传给他指向的布局，这样就可以使用 ViewStub 来设置是否显示某个布局。")]),t._v(" "),n("h4",{attrs:{id:"主要使用场景-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主要使用场景-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 主要使用场景")]),t._v(" "),n("ul",[n("li",[t._v("在程序运行期间，某个布局在加载后就不会有变化，除非销毁该界面重新加载。")]),t._v(" "),n("li",[t._v("想要控制显示与隐藏的是一个布局文件，而不是 View")])]),t._v(" "),n("h4",{attrs:{id:"注意事项-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意事项-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 注意事项")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("ViewStub")]),t._v(" 只能加载一次，之后的 "),n("code",[t._v("ViewStub")]),t._v(" 对象将会被置空，换句话说，某个被 "),n("code",[t._v("ViewStub")]),t._v(" 指定加载的布局被加载后，就不能再通过 ViewStub 来控制它了，所以它不适用于按需隐藏的情况(还是只有使用 "),n("code",[t._v("setVisiable")]),t._v(" 的方式)。")]),t._v(" "),n("li",[n("code",[t._v("ViewStub")]),t._v(" 只能用来加载一个布局文件，而不是一个具体的 View（除非将一个 View 放入一个布局文件中）。")]),t._v(" "),n("li",[n("code",[t._v("ViewStub")]),t._v(" 中不能再嵌套 "),n("code",[t._v("Merge")]),t._v(" 标签了。")])]),t._v(" "),n("h3",{attrs:{id:"（四）、布局复用使用-include-标签"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#（四）、布局复用使用-include-标签","aria-hidden":"true"}},[t._v("#")]),t._v(" （四）、布局复用使用 include 标签")]),t._v(" "),n("p",[t._v("使用 include 标签。")]),t._v(" "),n("h3",{attrs:{id:"（五）、布局优化总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#（五）、布局优化总结","aria-hidden":"true"}},[t._v("#")]),t._v(" （五）、布局优化总结")]),t._v(" "),n("p",[t._v("影响布局效率的主要是以下几个点：")]),t._v(" "),n("ul",[n("li",[t._v("布局层级越少，加载越快")]),t._v(" "),n("li",[t._v("减少同一层级控件的数量，加载速度会变快")]),t._v(" "),n("li",[t._v("一个控件的属性越少，加载会越快")])]),t._v(" "),n("p",[t._v("总结：")]),t._v(" "),n("ul",[n("li",[t._v("尽量多使用 "),n("code",[t._v("RelativiLayout")]),t._v(" 和 "),n("code",[t._v("LinearLayout")]),t._v("，不要使用 "),n("code",[t._v("AbsoluteLayout")]),t._v(" 布局。")]),t._v(" "),n("li",[t._v("将可复用的组件抽取出来，并通过"),n("code",[t._v("<include/>")]),t._v("标签使用")]),t._v(" "),n("li",[t._v("使用"),n("code",[t._v("<ViewStub/>")]),t._v("标签加载一个不变布局的的布局。")]),t._v(" "),n("li",[t._v("使用"),n("code",[t._v("<merge/>")]),t._v("标签减少布局的嵌套层次")]),t._v(" "),n("li",[t._v("尽可能少用 "),n("code",[t._v("wrap_content")]),t._v(","),n("code",[t._v("wrap_content")]),t._v(" 会增加布局 "),n("code",[t._v("Measure")]),t._v(" 的计算成本，已知高为固定值得时候，不要使用 wrap_content")]),t._v(" "),n("li",[t._v("删除控件中无用的属性。")])]),t._v(" "),n("h2",{attrs:{id:"三、合理的刷新机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、合理的刷新机制","aria-hidden":"true"}},[t._v("#")]),t._v(" 三、合理的刷新机制")]),t._v(" "),n("p",[t._v("在应用的开发中，因为数据的变化，需要刷新页面来展示数据，但是频繁的刷新会增加资源的开销，并且可能导致卡顿。\n合理的刷新机制需要注意以下几点：")]),t._v(" "),n("ul",[n("li",[t._v("尽量减少刷新的次数")]),t._v(" "),n("li",[t._v("尽量避免后台有高 CPU 线程运行")]),t._v(" "),n("li",[t._v("缩小刷新区域")])]),t._v(" "),n("h3",{attrs:{id:"（一）、减少刷新次数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#（一）、减少刷新次数","aria-hidden":"true"}},[t._v("#")]),t._v(" （一）、减少刷新次数")]),t._v(" "),n("ul",[n("li",[t._v("控制刷新的频率\n比如在显示进度条的时候，不需要每一个进度的时候都需要显示，可以做到每隔多少刷新显示一次，这样就减少了刷新的频率。")]),t._v(" "),n("li",[t._v("避免没有必要的刷新\n首先需要判断是否需要刷新，比如数据没有变化的时候，需要刷新的控件不在可见区域内，就没必要刷新，但是需要注意的是：如果一个 View 从不可见到可见，一定要刷新一次。")])]),t._v(" "),n("h3",{attrs:{id:"（二）、避免后台线程影响"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#（二）、避免后台线程影响","aria-hidden":"true"}},[t._v("#")]),t._v(" （二）、避免后台线程影响")]),t._v(" "),n("p",[t._v("后台线程过大会导致 CPU 占比过高，导致频繁的 GC 和 CPU 时间片资源紧张，还是优肯会导致页面的卡顿。比如在 RecyclerView 或者 ListView 在滑动的时候就可以暂停其他的 UI 操作：\n通过监听 ListView 的 onScrollStateChanged 事件，在滚动的时候暂停下载图片和下载进程工作，结束后再刷新可以提高 ListView 的滑动平滑度。（具体详见：Android 缓存策略和 Bitmap 高效加载）。")]),t._v(" "),n("h3",{attrs:{id:"（三）、缩小刷新的区域"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#（三）、缩小刷新的区域","aria-hidden":"true"}},[t._v("#")]),t._v(" （三）、缩小刷新的区域")]),t._v(" "),n("h4",{attrs:{id:"在自定义-view-中"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在自定义-view-中","aria-hidden":"true"}},[t._v("#")]),t._v(" 在自定义 "),n("code",[t._v("View")]),t._v(" 中")]),t._v(" "),n("p",[t._v("在自定义 View 中一般采用 "),n("code",[t._v("invalidata")]),t._v(" 方法刷新，如果需要更新数据，只是在某个区域的话，在调用了 "),n("code",[t._v("invalidata")]),t._v(" 就会更新整个视图，这就浪费了不需要更新区域的资源。我们采用两种更新局部数据的方法。")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("invalidata"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Rect dirty"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ninvalidata"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("int left,int top,int right,int bottom"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h4",{attrs:{id:"容器中的某个-item-发生了变化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#容器中的某个-item-发生了变化","aria-hidden":"true"}},[t._v("#")]),t._v(" 容器中的某个 Item 发生了变化")]),t._v(" "),n("p",[t._v("只需要更新这个 Item 就行了。比如在 "),n("code",[t._v("ListView")]),t._v(" 中或者 "),n("code",[t._v("RecyclerView")]),t._v(" 中，如果是单条操作，就必须调用 "),n("code",[t._v("Adapter")]),t._v(" 的 "),n("code",[t._v("notifyDataChanged")]),t._v("()刷新。")]),t._v(" "),n("h4",{attrs:{id:"invalidate-函数的区域更新例子"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#invalidate-函数的区域更新例子","aria-hidden":"true"}},[t._v("#")]),t._v(" invalidate()函数的区域更新例子")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FingerView")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("View")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),t._v(" STROKE_WIDTH "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** Need to track this so the dirty region can accommodate the stroke. **/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),t._v(" HALF_STROKE_WIDTH "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" STROKE_WIDTH "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Paint")]),t._v(" paint "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Paint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Path")]),t._v(" path "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n  * Optimizes painting by invalidating the smallest possible area.\n  */")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),t._v(" lastTouchX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),t._v(" lastTouchY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RectF")]),t._v(" dirtyRect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RectF")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("span style"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"font-family: Arial, Helvetica, sans-serif; font-size: ;"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FingerView")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("span"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),t._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AttributeSet")]),t._v(" attrs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" attrs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n   paint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAntiAlias")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   paint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setColor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Color")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BLACK"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   paint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setStyle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Paint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Style")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("STROKE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   paint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setStrokeJoin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Paint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Join")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ROUND"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   paint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setStrokeWidth")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("STROKE_WIDTH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n  * Erases the signature.\n  */")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("clear")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("reset")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Repaints the entire view.")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invalidate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onDraw")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Canvas")]),t._v(" canvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   canvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("drawPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" paint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onTouchEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MotionEvent")]),t._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),t._v(" eventX "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getX")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),t._v(" eventY "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getY")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAction")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MotionEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ACTION_DOWN"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n       path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("moveTo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eventY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n       lastTouchX "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" eventX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n       lastTouchY "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" eventY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// There is no end point yet, so don't waste cycles invalidating.")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MotionEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ACTION_MOVE"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MotionEvent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ACTION_UP"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Start tracking the dirty region.")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resetDirtyRect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eventY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// When the hardware tracks events faster than they are delivered,")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// event will contain a history of those skipped points.")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" historySize "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHistorySize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" historySize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),t._v(" historicalX "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHistoricalX")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),t._v(" historicalY "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHistoricalY")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("expandDirtyRect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("historicalX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" historicalY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n         path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("lineTo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("historicalX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" historicalY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// After replaying history, connect the line to the touch point.")]),t._v("\n       path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("lineTo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("eventX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eventY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("debug")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Ignored touch event: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Include half the stroke width to avoid clipping.")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("invalidate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dirtyRect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("left "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" HALF_STROKE_WIDTH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dirtyRect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("top "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" HALF_STROKE_WIDTH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dirtyRect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("right "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" HALF_STROKE_WIDTH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dirtyRect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bottom "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" HALF_STROKE_WIDTH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n   lastTouchX "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" eventX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   lastTouchY "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" eventY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n  * Called when replaying history to ensure the dirty region includes all\n  * points.\n  */")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("expandDirtyRect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),t._v(" historicalX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),t._v(" historicalY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("historicalX "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" dirtyRect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("left"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     dirtyRect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("left "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" historicalX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("historicalX "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" dirtyRect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("right"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      dirtyRect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("right "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" historicalX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("historicalY "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" dirtyRect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("top"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      dirtyRect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("top "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" historicalY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("historicalY "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" dirtyRect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bottom"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      dirtyRect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bottom "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" historicalY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * Resets the dirty region when the motion event occurs.\n   */")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resetDirtyRect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),t._v(" eventX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),t._v(" eventY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The lastTouchX and lastTouchY were set when the ACTION_DOWN")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// motion event occurred.")]),t._v("\n    dirtyRect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("left "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Math")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("min")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lastTouchX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eventX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    dirtyRect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("right "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Math")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("max")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lastTouchX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eventX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    dirtyRect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("top "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Math")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("min")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lastTouchY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eventY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    dirtyRect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bottom "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Math")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("max")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lastTouchY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" eventY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),n("h2",{attrs:{id:"四、提升动画性能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、提升动画性能","aria-hidden":"true"}},[t._v("#")]),t._v(" 四、提升动画性能")]),t._v(" "),n("p",[n("code",[t._v("Android")]),t._v(" 提供三个平台框架，帧动画（太耗资源能不用就不用），补间动画（包括：淡入淡出 "),n("code",[t._v("AlphaAnimation，缩放")]),t._v(" "),n("code",[t._v("ScaleAnimation")]),t._v(",平移 "),n("code",[t._v("TranslationAnimation")]),t._v(",和旋转 "),n("code",[t._v("RotateAnimation")]),t._v("），和属性动画。")]),t._v(" "),n("h3",{attrs:{id:"（一）、使用属性动画"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#（一）、使用属性动画","aria-hidden":"true"}},[t._v("#")]),t._v(" （一）、使用属性动画")]),t._v(" "),n("h4",{attrs:{id:"_1、补间动画局限性："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、补间动画局限性：","aria-hidden":"true"}},[t._v("#")]),t._v(" 1、补间动画局限性：")]),t._v(" "),n("ul",[n("li",[t._v("补间动画只能用于 View 对象，也就是继承于 View 或者 View 的控件。")]),t._v(" "),n("li",[t._v("只有四种动画操作，淡入淡出，缩放，平移，旋转")]),t._v(" "),n("li",[t._v("不见动画是改变 View 的显示效果，但是没有改变真正的属性。也就是假设 View 移动了，要是点击移动后的地方是没有用的，还是只能点击期初的位置。")])]),t._v(" "),n("h4",{attrs:{id:"_2、属性动画的特性："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、属性动画的特性：","aria-hidden":"true"}},[t._v("#")]),t._v(" 2、属性动画的特性：")]),t._v(" "),n("ul",[n("li",[t._v("持续时间：默认长度 300Ms")]),t._v(" "),n("li",[t._v("时间插值器（Time Interpolation）。能够指定为计算当前动画运行时间的函数的属性值来觉得动画范围内的变化频率。")]),t._v(" "),n("li",[t._v("重复次数和行为。")]),t._v(" "),n("li",[t._v("动画集合（AnimationsSet）")]),t._v(" "),n("li",[t._v("帧刷新延迟：默认 10s 刷新一次。")])]),t._v(" "),n("p",[t._v("具体的使用："),n("strong",[t._v("查看 View 相关技术--\x3eAnimation 相关---\x3e属性动画")])]),t._v(" "),n("h3",{attrs:{id:"（二）、硬件加速"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#（二）、硬件加速","aria-hidden":"true"}},[t._v("#")]),t._v(" （二）、硬件加速")]),t._v(" "),n("h4",{attrs:{id:"_1、硬件加速原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、硬件加速原理","aria-hidden":"true"}},[t._v("#")]),t._v(" 1、硬件加速原理")]),t._v(" "),n("p",[t._v("在硬件加速渲染模型中有一个重要的核心类："),n("strong",[t._v("DisplayList,每个 View 内部都会维护一个 DisplayList")]),t._v("。")]),t._v(" "),n("p",[t._v("在不支持硬件加速的版本中，View 的更新通过 "),n("code",[t._v("draw")]),t._v(" 和 "),n("code",[t._v("invalidate")]),t._v("()方法通知更新并重新渲染。")]),t._v(" "),n("p",[t._v("在支持硬件加速的版本中，其中执行绘制的 "),n("code",[t._v("draw")]),t._v(" 方法会把所有绘制命令记录到一个新的显示列表（DisplayList），这个 "),n("code",[t._v("DisplayList")]),t._v(" 包含输出的 View 层级绘制代码，但是并不是加入到显示列表立即执行，当 ViewTree 的 DisplayList 全部记录完毕后，由 "),n("code",[t._v("OpenGLRender")]),t._v(" 负责将 root view 的 "),n("code",[t._v("DisplayList")]),t._v(" 渲染到屏幕上，而 invalidate（）只是显示列表中的记录和更新显示层级就可以了，不用更新 View。")]),t._v(" "),n("h4",{attrs:{id:"_2、硬件加速的级别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、硬件加速的级别","aria-hidden":"true"}},[t._v("#")]),t._v(" 2、硬件加速的级别")]),t._v(" "),n("ul",[n("li",[t._v('Application 级别：在 Mnifest.xml 文件中的 application 中添加属性：android:hardwareAccelerated="true"，这样整个应用都采用硬件加速')]),t._v(" "),n("li",[t._v("Activity 级别：在"),n("code",[t._v('<activity android:hardwareAccelerated="true"/>')])]),t._v(" "),n("li",[t._v("Window 级别："),n("code",[t._v("getWindow().setFlags(WindowManager.LayoutParams.FLAG_HARDWARE_ACCELERATED,WindowManager.LayoutParams.FLAG_HARDWARE_ACCELERATED).")])]),t._v(" "),n("li",[t._v("View 级别："),n("code",[t._v("View.setLayerType(View.LAYER_TYPE_SOFTWARE,null).")])])]),t._v(" "),n("h4",{attrs:{id:"_3、在动画上使用硬件加速"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3、在动画上使用硬件加速","aria-hidden":"true"}},[t._v("#")]),t._v(" 3、在动画上使用硬件加速")]),t._v(" "),n("p",[t._v("使用 "),n("code",[t._v("view.setLayerType(type,Paint)")]),t._v("方法，第一个参数是使用的层类型，第二个参数为可选参数，可以吧 "),n("code",[t._v("paint")]),t._v(" 参数应用到颜色过滤上，特别是混合模式或者是对一个 Layer 进行不透明处理。\n类型有以下几种：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("LAYER_TYPE_NONE")]),t._v(":默认渲染方式，不会返回一个离线缓冲，默认值")]),t._v(" "),n("li",[n("code",[t._v("LAYER_TYPE_HARDWARE")]),t._v(":使用硬件加速")]),t._v(" "),n("li",[n("code",[t._v("LAYER_TYPE_SOFTWARE")]),t._v(":此 View 通过软件渲染为一个 Bitmap。")])]),t._v(" "),n("p",[t._v("设计动画的流程：\n将要执行动画的 "),n("code",[t._v("View")]),t._v(" 的 "),n("code",[t._v("TYPE")]),t._v(" 设置为 "),n("code",[t._v("LAYER_TYPE_HARDWARE。")]),t._v("\n计算动画 View 的属性和信息，更新 view 的属性\n若动画结束，将 "),n("code",[t._v("LayerType")]),t._v(" 设置为 "),n("code",[t._v("None。")])]),t._v(" "),n("h3",{attrs:{id:"（三）、硬件加速的问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#（三）、硬件加速的问题","aria-hidden":"true"}},[t._v("#")]),t._v(" （三）、硬件加速的问题")]),t._v(" "),n("ul",[n("li",[t._v("在软件渲染的时候，可以重用 Bitmap 的方法来节省内存，但是如果开启硬件加速就不行了。")]),t._v(" "),n("li",[t._v("开启硬件加速的 view 在前台运行，需要耗费额外的内存，加速的 UI 切换到后台时，产生的额外内存可能不会释放。")]),t._v(" "),n("li",[t._v("当 UI 中存在过度绘制时候，硬件加速会比较容易发生问题。")])])])}),[],!1,null,null,null);a.default=e.exports}}]);