(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{298:function(t,s,a){t.exports=a.p+"assets/img/quic.0647b665.png"},299:function(t,s,a){t.exports=a.p+"assets/img/wireshark.2baa0e8c.png"},300:function(t,s,a){t.exports=a.p+"assets/img/test.1de8d8a5.png"},301:function(t,s,a){t.exports=a.p+"assets/img/httptest.4033bac1.png"},423:function(t,s,a){"use strict";a.r(s);var n=a(1),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("blockquote",[n("p",[t._v("导语: 最近一直在优化 rn 的下载速度，尝试过 "),n("code",[t._v("bundle")]),t._v(" 分包，资源压缩等一系列手段，发现优化后的 "),n("code",[t._v("bundle")]),t._v("(200kb,gzip:67.2k)下载时间也需要 "),n("code",[t._v("300ms")]),t._v(" 左右的时间。最后我们选择使用 "),n("code",[t._v("QUIC")]),t._v(" 协议来尝试 "),n("code",[t._v("bundle")]),t._v(" 下载，下文主要简单介绍 "),n("code",[t._v("QUIC")]),t._v(" 协议的使用。")])]),t._v(" "),n("h2",{attrs:{id:"quic-协议是干嘛的？"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#quic-协议是干嘛的？","aria-hidden":"true"}},[t._v("#")]),t._v(" QUIC 协议是干嘛的？")]),t._v(" "),n("p",[t._v("我想"),n("a",{attrs:{href:"http://km.oa.com/articles/show/435666?kmref=author_post",target:"_blank",rel:"noopener noreferrer"}},[t._v("这篇文章: QUIC 分享"),n("OutboundLink")],1),t._v("对于 "),n("code",[t._v("QUIC 和 http2 的区别")]),t._v("以及 "),n("code",[t._v("QUIC 如何做多路复用和握手")]),t._v("讲的非常详细了。")]),t._v(" "),n("p",[t._v("建议查看如下内容之前，先阅读上文，知晓 "),n("code",[t._v("QUIC")]),t._v(" 和 "),n("code",[t._v("http1.0")]),t._v(","),n("code",[t._v("http1.1")]),t._v(","),n("code",[t._v("http2.0")]),t._v("的区别。")]),t._v(" "),n("blockquote",[n("p",[n("code",[t._v("QUIC")]),t._v("（Quick UDP Internet Connections，读 quick）是由 "),n("code",[t._v("Google")]),t._v(" 提出的一种基于 "),n("code",[t._v("UDP")]),t._v(" 改进的低时延的互联网传输层.")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(298),alt:""}})]),t._v(" "),n("p",[t._v("QUIC 相比 http2.0 有如下优点:")]),t._v(" "),n("ul",[n("li",[t._v("支持 0-RTT 连接(最多 1-RTT)")]),t._v(" "),n("li",[t._v("用户域的拥塞控制，协议可快速部署、更新")]),t._v(" "),n("li",[t._v("UDP 天然无队头阻塞问题")]),t._v(" "),n("li",[t._v("连接迁移")]),t._v(" "),n("li",[t._v("前向纠错")])]),t._v(" "),n("p",[t._v("那么项目如何接入 "),n("code",[t._v("QUIC")]),t._v(" 协议呢？")]),t._v(" "),n("p",[t._v("要使用 "),n("code",[t._v("QUIC")]),t._v(" 协议需要客户端和服务端支持，客户端需要使用 "),n("code",[t._v("Google")]),t._v(" 工具"),n("code",[t._v("Cronet")]),t._v("，下文将详细介绍如何编译客户端包，以及如何使用。")]),t._v(" "),n("h2",{attrs:{id:"cronet-客户端依赖包编译"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cronet-客户端依赖包编译","aria-hidden":"true"}},[t._v("#")]),t._v(" Cronet 客户端依赖包编译")]),t._v(" "),n("h3",{attrs:{id:"什么是-cronet"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是-cronet","aria-hidden":"true"}},[t._v("#")]),t._v(" 什么是 Cronet ?")]),t._v(" "),n("p",[t._v("这可能是最好的 "),n("code",[t._v("Cronet")]),t._v(" 文档说明:")]),t._v(" "),n("blockquote",[n("p",[t._v("Cronet is the networking stack of Chromium put into a library for use on mobile. This is the same networking stack that is used in the Chrome browser by over a billion people. It offers an easy-to-use, high performance, standards-compliant, and secure way to perform HTTP requests. Cronet has support for both Android and iOS.")])]),t._v(" "),n("p",[t._v("大致的意思是 Cronet 是一个移动端谷歌浏览器使用的网络请求库，拥有易用、高性能、安全和高标准的特点，目前以及在 android 和 iOS 中使用。")]),t._v(" "),n("p",[t._v("Cronet 支持如下功能:")]),t._v(" "),n("ul",[n("li",[t._v("支持 "),n("code",[t._v("http2")]),t._v(" 协议")]),t._v(" "),n("li",[t._v("支持 "),n("code",[t._v("quic")]),t._v(" 协议,默认情况如何服务端不支持 quic 协议，将会采用降级策略降级至 http2")]),t._v(" "),n("li",[t._v("支持 "),n("code",[t._v("Brotli")]),t._v(" 压缩")]),t._v(" "),n("li",[t._v("支持 "),n("code",[t._v("Metrics")])]),t._v(" "),n("li",[t._v("支持缓存，日志记录")]),t._v(" "),n("li",[t._v("等等")])]),t._v(" "),n("h3",{attrs:{id:"如何编译-android-和-ios-的依赖包？"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何编译-android-和-ios-的依赖包？","aria-hidden":"true"}},[t._v("#")]),t._v(" 如何编译 Android 和 iOS 的依赖包？")]),t._v(" "),n("ol",[n("li",[n("strong",[t._v("编译系统要求")])])]),t._v(" "),n("ul",[n("li",[t._v("64 位 Mac 10.12.6+")]),t._v(" "),n("li",[t._v("Xcode 11.4+.")]),t._v(" "),n("li",[t._v("最新的 JDK")])]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[n("strong",[t._v("获取源码")])])]),t._v(" "),n("p",[n("code",[t._v("iOS")]),t._v(" 的必须在 "),n("code",[t._v("mac")]),t._v(" "),n("code",[t._v("下编译，Android")]),t._v(" 必须要 "),n("code",[t._v("linux")]),t._v(" 平台下编译。")]),t._v(" "),n("ul",[n("li",[t._v("安装 "),n("code",[t._v("depot_tools")]),t._v(" 工具\n在任意目录下载 "),n("code",[t._v("depot_tools")]),t._v(" 源码，并将该项目根目录添加到 "),n("code",[t._v("PATH")]),t._v("(添加到"),n("code",[t._v("~/.bashrc")]),t._v(" 或者 "),n("code",[t._v("~/.zshrc")]),t._v(", 记得"),n("code",[t._v("source ~/.zshrc")]),t._v(")，从而可以使用其工具比如 "),n("code",[t._v("fetch")]),t._v("。")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://chromium.googlesource.com/chromium/tools/depot_tools.git\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),n("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PATH")]),t._v(':/path/to/depot_tools"')]),t._v("\n")])])]),n("ul",[n("li",[t._v("拉取 "),n("code",[t._v("chromium")]),t._v(" 源码 这里需要区分是拉取 "),n("code",[t._v("Android")]),t._v(" 平台的，还是 "),n("code",[t._v("iOS")]),t._v(" 平台的")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" chromium\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 记得 --no-history --nohooks提高拉取速度，此处拉取大约需要30min")]),t._v("\nfetch --no-history --nohooks  android      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# fetch --no-history  --nohooks  ios")]),t._v("\n")])])]),n("ol",{attrs:{start:"3"}},[n("li",[n("strong",[t._v("编译")])])]),t._v(" "),n("p",[t._v("进入 "),n("code",[t._v("chromium/src")]),t._v(" 目录，执行下面命令，")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下载依赖")]),t._v("\n~/chromium/src $ gclient "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),t._v("\n~/chromium/src $ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s /path/to/components/cronet/tools/cr_cronet.py ./cr_cronet.py\n~/chromium/src $ ./cr_cronet.py gn --out_dir"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("out/Cronet\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 构建iOS模拟器包")]),t._v("\n~/chromium/src $ ninja -C out/Cronet cronet_package\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 构建release包")]),t._v("\n~/chromium/src $ ./cr_cronet.py gn -i --release --out_dir"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("out/Cronet-iphoneos-release\n")])])]),n("p",[t._v("对于 "),n("code",[t._v("release")]),t._v(" 版本的 "),n("code",[t._v("Cronet")]),t._v(" 包，需要在构建的时候添加"),n("code",[t._v("--release")]),t._v("选项，另外 "),n("code",[t._v("iOS")]),t._v(" 版本会区分模拟器和真机，区别是 cpu 架构不一样，模拟器使用 "),n("code",[t._v("x86")]),t._v(" 架构，真机使用的 ARM 架构。\n上述 cr_cronet.py 命令默认生成模拟器版本的库，生成真机的库需要添加 "),n("code",[t._v("-i")]),t._v(" 选项，同时必须具有 iOS 开发者证书，并在 xcode 中配置好。")]),t._v(" "),n("p",[t._v("至此你可以在"),n("code",[t._v("src/out/Cronet/Static")]),t._v("目录下已然生成"),n("code",[t._v("Cronet.framework")]),t._v("。")]),t._v(" "),n("h2",{attrs:{id:"如何使用-cronet"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何使用-cronet","aria-hidden":"true"}},[t._v("#")]),t._v(" 如何使用 Cronet")]),t._v(" "),n("h3",{attrs:{id:"cronet-在-android-中使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cronet-在-android-中使用","aria-hidden":"true"}},[t._v("#")]),t._v(" Cronet 在 Android 中使用")]),t._v(" "),n("p",[t._v("如果你的项目么有使用到 okhttp，那么直接使用官方自带的库，也许是最好的选择.")]),t._v(" "),n("ol",[n("li",[t._v("添加依赖")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("dependencies "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    implementation "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'com.google.android.gms:play-services-cronet:16.0.0'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("ol",{attrs:{start:"2"}},[n("li",[t._v("检查 Cronet 是否可用")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CronetProviderInstaller")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("installProvider")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reactContext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addOnCompleteListener")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OnCompleteListener")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onComplete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@NonNull")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Task")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" task"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("task"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isSuccessful")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 初始化Cronet代码")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ol",{attrs:{start:"3"}},[n("li",[n("a",{attrs:{name:"android_cronet"}},[t._v("初始化 "),n("code",[t._v("Cronet")]),t._v(" 引擎，并发送请求")])])]),t._v(" "),n("p",[t._v("发送请求大致分为如下几步:")]),t._v(" "),n("ul",[n("li",[t._v("创建并配置"),n("code",[t._v("CronetEngine")]),t._v("单实例")]),t._v(" "),n("li",[t._v("提供请求回调的实现")]),t._v(" "),n("li",[t._v("创建 Executor 对象来管理网络请求任务")]),t._v(" "),n("li",[t._v("创建和配置 UrlRequest 对象")])]),t._v(" "),n("p",[n("strong",[t._v("第一步: 创建并配置"),n("code",[t._v("CronetEngine")]),t._v("单实例")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CronetEngine")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCronetEngine")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),t._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Lazily create the Cronet engine.")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cronetEngine "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CronetEngine")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Builder")]),t._v(" myBuilder "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CronetEngine")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Builder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Enable caching of HTTP data and")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// other information like QUIC server information, HTTP/2 protocol and QUIC protocol.")]),t._v("\n            cronetEngine "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" myBuilder\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("enableHttpCache")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CronetEngine")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Builder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HTTP_CACHE_DISABLED"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addQuicHint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"stgwhttps.kof.qq.com"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//.enableHttp2(true)")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("enableQuic")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//    .setUserAgent("clb_quic_demo")')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" cronetEngine"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("strong",[t._v("第二步: 提供请求回调的实现")])]),t._v(" "),n("p",[t._v("方法详细回调，请见"),n("a",{attrs:{href:"https://developer.android.com/guide/topics/connectivity/cronet/start?hl=zh-cn#java",target:"_blank",rel:"noopener noreferrer"}},[t._v("Android Developer Cronet"),n("OutboundLink")],1)]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SimpleUrlRequestCallback")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UrlRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Callback")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ByteArrayOutputStream")]),t._v(" bytesReceived "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ByteArrayOutputStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WritableByteChannel")]),t._v(" receiveChannel "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Channels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("newChannel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytesReceived"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ImageView")]),t._v(" imageView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" stop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Activity")]),t._v(" mainActivity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SimpleUrlRequestCallback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ImageView")]),t._v(" imageView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Context")]),t._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("imageView "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" imageView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mainActivity "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Activity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onRedirectReceived")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UrlRequest")]),t._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UrlResponseInfo")]),t._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" newLocationUrl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            android"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("i")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TAG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"****** onRedirectReceived ******"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("followRedirect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onResponseStarted")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UrlRequest")]),t._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UrlResponseInfo")]),t._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            android"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("i")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TAG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"****** Response Started ******"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            android"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("i")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TAG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*** Headers Are *** "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getAllHeaders")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("read")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ByteBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("allocateDirect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onReadCompleted")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UrlRequest")]),t._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UrlResponseInfo")]),t._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ByteBuffer")]),t._v(" byteBuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            android"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("i")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TAG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"****** onReadCompleted ******"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" byteBuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            byteBuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("flip")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                receiveChannel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("byteBuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),t._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                android"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("i")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TAG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"IOException during ByteBuffer read. Details: "')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            byteBuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("clear")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("read")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("byteBuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onSucceeded")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UrlRequest")]),t._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UrlResponseInfo")]),t._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n            stop "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nanoTime")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            android"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("i")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TAG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"****** Cronet Request Completed, the latency is "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stop "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            android"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("i")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TAG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"****** Cronet Request Completed, status code is "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHttpStatusCode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                            "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('", total received bytes is "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getReceivedByteCount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Set the latency")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MainActivity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addCronetLatency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stop "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" byteArray "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bytesReceived"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toByteArray")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bitmap")]),t._v(" bimage "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BitmapFactory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("decodeByteArray")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("byteArray"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" byteArray"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            mainActivity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("runOnUiThread")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runnable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    imageView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImageBitmap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bimage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    imageView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLayoutParams")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("height "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bimage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeight")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    imageView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLayoutParams")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("width "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bimage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getWidth")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("onFailed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UrlRequest")]),t._v(" var1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UrlResponseInfo")]),t._v(" var2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CronetException")]),t._v(" var3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            android"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("i")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TAG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"****** onFailed, error is: "')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" var3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),n("p",[t._v("此处代码参考"),n("a",{attrs:{href:"https://github.com/tencentyun/clb-quic-demo",target:"_blank",rel:"noopener noreferrer"}},[t._v("CLB quic demo"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("strong",[t._v("第三步: 创建 Executor 对象来管理网络请求任务")])]),t._v(" "),n("p",[t._v("可以使用 Executor 类执行网络任务。要获取 Executor 的实例，请使用返回 Executor 对象的 Executors 类的任一静态方法。以下示例展示了如何使用 newSingleThreadExecutor() 方法创建 Executor 对象：")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executor")]),t._v(" executor "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executors")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("newSingleThreadExecutor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[n("strong",[t._v("第四步: 创建和配置 UrlRequest 对象")])]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UrlRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Callback")]),t._v(" callback "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SimpleUrlRequestCallback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("holder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mImageViewCronet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UrlRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Builder")]),t._v(" builder "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cronetEngine"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("newUrlRequestBuilder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ImageRepository")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getImage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("position"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" executor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Measure the start time of the request so that")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// we can measure latency of the entire request cycle")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SimpleUrlRequestCallback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("start "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nanoTime")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Start the request")]),t._v("\nbuilder"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h3",{attrs:{id:"cronet-在有-okhttp-的-android-中使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cronet-在有-okhttp-的-android-中使用","aria-hidden":"true"}},[t._v("#")]),t._v(" Cronet 在有 okhttp 的 Android 中使用")]),t._v(" "),n("ol",[n("li",[t._v("项目中有使用到"),n("code",[t._v("Retrofit")])])]),t._v(" "),n("p",[t._v("你可以使用"),n("code",[t._v("Retrofit.Builder.callFactory")]),t._v("去自定义一个 call；")]),t._v(" "),n("p",[t._v("一个简单的例子: "),n("a",{attrs:{href:"https://github.com/akshetpandey/react-native-cronet/blob/master/android/src/main/java/com/akshetpandey/rncronet/RNCronetOkHttpCall.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("RNCronetOkHttpCall.java"),n("OutboundLink")],1)]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[t._v("没有 "),n("code",[t._v("Retrofit")])])]),t._v(" "),n("p",[t._v("在没有"),n("code",[t._v("Retrofit")]),t._v("的工程中国，你可以使用 okhttp 的"),n("code",[t._v("interceptor")]),t._v("去处理 cronet。")]),t._v(" "),n("p",[t._v("一个简单的例子: "),n("a",{attrs:{href:"https://github.com/akshetpandey/react-native-cronet/blob/master/android/src/main/java/com/akshetpandey/rncronet/RNCronetInterceptor.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("RNCronetInterceptor.java"),n("OutboundLink")],1)]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[t._v("初始化 "),n("code",[t._v("Cronet")]),t._v(" 引擎，并发送请求")])]),t._v(" "),n("p",[n("a",{attrs:{href:"#android_cronet"}},[t._v("同上")])]),t._v(" "),n("h3",{attrs:{id:"cronet-在-ios-中使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cronet-在-ios-中使用","aria-hidden":"true"}},[t._v("#")]),t._v(" Cronet 在 iOS 中使用")]),t._v(" "),n("p",[t._v("利用前一个构建步骤生成的"),n("code",[t._v("Cronet.framework")]),t._v("导入到 xcode 中即可使用。")]),t._v(" "),n("p",[t._v("使用方式如下:")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v("#include "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cronet")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cronet")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("h"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cronet")]),t._v(" setHttp2Enabled"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("YES"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cronet")]),t._v(" setQuicEnabled"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("YES"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cronet")]),t._v(" setBrotliEnabled"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("YES"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cronet")]),t._v(" setHttpCacheType"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CRNHttpCacheTypeDisk")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cronet")]),t._v(" addQuicHint"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("@"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"www.google.com"')]),t._v(" port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v(" altPort"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cronet")]),t._v(" start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cronet")]),t._v(" registerHttpProtocolHandler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("没错，在 iOS 中使用就是如此简单，当我们初始化了 Cronet 引擎之后，在使用 "),n("code",[t._v("NSURLSession")]),t._v(" 和 "),n("code",[t._v("NSURLConnection")]),t._v("时会自动使用。")]),t._v(" "),n("h2",{attrs:{id:"服务端支持-quic"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#服务端支持-quic","aria-hidden":"true"}},[t._v("#")]),t._v(" 服务端支持 QUIC")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("nginx 官方 nginx-quic: "),n("a",{attrs:{href:"https://hg.nginx.org/nginx-quic/",target:"_blank",rel:"noopener noreferrer"}},[t._v("nginx-quic"),n("OutboundLink")],1),t._v(", 编译步骤参考"),n("a",{attrs:{href:"https://juejin.im/post/6850418105462571021",target:"_blank",rel:"noopener noreferrer"}},[t._v("在 nginx 中支持 HTTP3.0/QUIC"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[t._v("基于 "),n("code",[t._v("cloudflare")]),t._v(" 的分支版本 "),n("code",[t._v("nginx")]),t._v(": 对于 H"),n("code",[t._v("TTP3.0/QUIC")]),t._v("，Cloudflare 始终走在了前列，借助于自家维护的开源项目 quic，从 "),n("code",[t._v("nginx")]),t._v(" 中拉出了一个分支来开发，并编译出了对 "),n("code",[t._v("HTTP3.0")]),t._v("支持的 "),n("code",[t._v("nginx")]),t._v(" 服务器")])])]),t._v(" "),n("h2",{attrs:{id:"如何测试-quic-是否生效"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何测试-quic-是否生效","aria-hidden":"true"}},[t._v("#")]),t._v(" 如何测试 QUIC 是否生效")]),t._v(" "),n("p",[t._v("在文章之处已经提过，使用 QUIC 协议需要客户端和服务端支持，如果您已经部署到 quic 协议，客户端也已经实现，您可以使用如下几种方案检查是否 quic 生效:")]),t._v(" "),n("ol",[n("li",[t._v("使用"),n("code",[t._v("WireShark")]),t._v("("),n("strong",[t._v("推荐，也是最可靠的方式")]),t._v(")，如果使用 chrome 浏览器或者网上的其他方式，很可能抓包时显示的是 h2 协议，因为 quic 协议和浏览器支持的版本也是有关系的。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(299),alt:""}})]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[n("p",[t._v("使用检查工具"),n("a",{attrs:{href:"https://gf.dev/http3-test",target:"_blank",rel:"noopener noreferrer"}},[t._v("http3-test"),n("OutboundLink")],1),t._v(" "),n("img",{attrs:{src:a(300),alt:""}})])]),t._v(" "),n("li",[n("p",[t._v("使用检查工具"),n("a",{attrs:{href:"https://www.http3check.net/",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP/3 Test"),n("OutboundLink")],1)])])]),t._v(" "),n("p",[n("img",{attrs:{src:a(301),alt:""}})]),t._v(" "),n("ol",{attrs:{start:"4"}},[n("li",[t._v("Firefox(tips: 笔者并未尝试成功，但是有同学尝试成功过)")])]),t._v(" "),n("ul",[n("li",[t._v("启动 Firefox Nightly")]),t._v(" "),n("li",[t._v("输入"),n("code",[t._v("about:config")])]),t._v(" "),n("li",[t._v("搜索"),n("code",[t._v("network.http.http3.enabled")]),t._v("并设置为"),n("code",[t._v("enable")])]),t._v(" "),n("li",[t._v("重启浏览器并打开开发者工具")]),t._v(" "),n("li",[t._v("查看对应协议")])]),t._v(" "),n("ol",{attrs:{start:"5"}},[n("li",[t._v("cURL")])]),t._v(" "),n("p",[t._v("首先必须升级到"),n("a",{attrs:{href:"https://github.com/curl/curl/blob/master/docs/HTTP3.md#quiche-version",target:"_blank",rel:"noopener noreferrer"}},[t._v("cURL 到最新的版本"),n("OutboundLink")],1),t._v(",")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 测试")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" --http3 https://www.google.com -I\n")])])]),n("h2",{attrs:{id:"quic-版本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#quic-版本","aria-hidden":"true"}},[t._v("#")]),t._v(" QUIC 版本")]),t._v(" "),n("p",[t._v("我们知道，"),n("code",[t._v("cronet")]),t._v(" 的版本和 "),n("code",[t._v("QUIC")]),t._v(" 协议的版本是有对应关系的，目前"),n("code",[t._v("implementation 'com.google.android.gms:play-services-cronet:16.0.0'")]),t._v("版本缩支持的 QUIC 协议版本如下:")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("constexpr std::array"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("QuicTransportVersion, "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("6")]),t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-name function"}},[t._v("SupportedTransportVersions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("QUIC_VERSION_IETF_DRAFT_29,\n          QUIC_VERSION_IETF_DRAFT_27,\n          QUIC_VERSION_51,\n          QUIC_VERSION_50,\n          QUIC_VERSION_46,\n          QUIC_VERSION_43"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("其中 "),n("code",[t._v("IETF")]),t._v(" 的 "),n("code",[t._v("QUIC")]),t._v(" 版本和 "),n("code",[t._v("Google QUIC")]),t._v(" 版本对应关系如下:")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v(" QUIC_VERSION_43 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("43")]),t._v(",  // PRIORITY frames are sent by client and accepted by\n                         // server.\n  // Version "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("44")]),t._v(" used IETF header "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),t._v(" from draft-ietf-quic-invariants-05.\n  // Version "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("45")]),t._v(" added MESSAGE frame.\n  QUIC_VERSION_46 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("46")]),t._v(",  // Use IETF draft-17 header "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),t._v(" with demultiplexing\n                         // bit.\n  // Version "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("47")]),t._v(" added variable-length QUIC server connection IDs.\n  // Version "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("48")]),t._v(" added CRYPTO frames "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" the handshake.\n  // Version "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("49")]),t._v(" added client connection IDs, long header lengths, and the IETF\n  // header "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),t._v(" from draft-ietf-quic-invariants-06\n  QUIC_VERSION_50 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v(",  // Header protection and initial obfuscators.\n  QUIC_VERSION_51 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("51")]),t._v(",  // draft-29 features but with GoogleQUIC frames.\n  // Number "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("70")]),t._v(" used to represent draft-ietf-quic-transport-25.\n  QUIC_VERSION_IETF_DRAFT_27 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("71")]),t._v(",  // draft-ietf-quic-transport-27.\n  // Number "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("72")]),t._v(" used to represent draft-ietf-quic-transport-28.\n  QUIC_VERSION_IETF_DRAFT_29 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("73")]),t._v(",  // draft-ietf-quic-transport-29.\n  // Version "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v(" was a dumping ground "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" IETF QUIC changes "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("which")]),t._v(" were not yet\n  // yet ready "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" production between "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),t._v("-02 and "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),t._v("-02.\n")])])]),n("p",[t._v("数据来源: "),n("a",{attrs:{href:"https://quiche.googlesource.com/quiche/+/refs/heads/master/quic/core/quic_versions.h",target:"_blank",rel:"noopener noreferrer"}},[t._v("google source"),n("OutboundLink")],1)]),t._v(" "),n("h2",{attrs:{id:"源码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#源码","aria-hidden":"true"}},[t._v("#")]),t._v(" 源码")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://git.code.oa.com/alexganggao/quic-ios-demo",target:"_blank",rel:"noopener noreferrer"}},[t._v("iOS: quic-ios-demo"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/tencentyun/clb-quic-demo",target:"_blank",rel:"noopener noreferrer"}},[t._v("CLB quic demo"),n("OutboundLink")],1)])]),t._v(" "),n("h2",{attrs:{id:"参考"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://chromium.googlesource.com/chromium/src/+/master/components/cronet/ios/docs/BUILD.md?autodive=0%2F%2F%2F%2F%2F",target:"_blank",rel:"noopener noreferrer"}},[t._v("Building Cronet (on iOS)"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:""}},[t._v("QUIC 协议")])]),t._v(" "),n("li",[n("a",{attrs:{href:"https://medium.com/the-react-native-log/using-cronet-in-your-mobile-app-7dda3a89c132",target:"_blank",rel:"noopener noreferrer"}},[t._v("Using HTTP3/QUIC with Cronet In Your Mobile App"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://developer.android.com/guide/topics/connectivity/cronet/start?hl=zh-cn#java",target:"_blank",rel:"noopener noreferrer"}},[t._v("Android developer"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/tencentyun/clb-quic-demo",target:"_blank",rel:"noopener noreferrer"}},[t._v("CLB quic demo"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);