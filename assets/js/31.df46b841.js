(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{702:function(t,s,a){t.exports=a.p+"assets/img/rn-total-time.454ed2b5.png"},703:function(t,s,a){t.exports=a.p+"assets/img/download-size.37f844a5.png"},704:function(t,s,a){t.exports=a.p+"assets/img/quic.0647b665.png"},705:function(t,s,a){t.exports=a.p+"assets/img/rn-single.250ea847.png"},706:function(t,s,a){t.exports=a.p+"assets/img/cgi.c2cd9554.png"},939:function(t,s,a){"use strict";a.r(s);var n=a(18),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"在腾讯我们是怎么做rn的性能优化的"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在腾讯我们是怎么做rn的性能优化的"}},[t._v("#")]),t._v(" 在腾讯我们是怎么做rn的性能优化的")]),t._v(" "),n("p",[t._v("这篇文章的标题可能有点大,作者的本意是想给大家分享一下在腾讯的这段时间从事 react-native 相关的工作,是如何对 react-native(下文称 rn)进行性能优化的,也许这是你看到的最全的一篇 rn 性能优化相关的文章.")]),t._v(" "),n("p",[t._v("由于笔者后续会较少的参与 rn 相关的工作,这篇文章也算是自己对这么久以来 rn 工作的总结吧,也希望对部分正在路上的同学有所启发和帮助.")]),t._v(" "),n("h2",{attrs:{id:"一、前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、前言"}},[t._v("#")]),t._v(" 一、前言")]),t._v(" "),n("p",[t._v("rn 官方的默认推荐方式是"),n("strong",[t._v("大家使用 rn 开发并作为独立的 app 使用")]),t._v(",但是对于较大体量的 app 考虑到框架迁移的成本以及对技术保持怀疑的态度 都不会直接使用 rn 开发一个独立的 app;反而更多的是将 rn 作为内部的一些独立模块/页面.")]),t._v(" "),n("p",[t._v("熟悉 rn 的同学应该都清楚,想要 rn 页面在 app 中启动需要内置其一堆底层框架,或者 rn 的 jsbundle; 而内置 rn 的 jsbundle 又分为两种,其优缺点也都较为明显;")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("jsbundle 全量内置")]),t._v(" "),n("ul",[n("li",[t._v("优点: 启动速度快")]),t._v(" "),n("li",[t._v("缺点: 每次更新 rn 页面都需要跟随 app 发版本,特别是针对页面出现重大 bug 的情况无法做到及时的更新;")])])]),t._v(" "),n("li",[n("p",[t._v("jsbundle 部分内置")]),t._v(" "),n("ul",[n("li",[t._v("优点: 内置通用的 jsbundle,动态下发业务 bundle;可以动态更新页面")]),t._v(" "),n("li",[t._v("缺点: 加载速度相比内置会多一个下载时间,启动速度会有少许的缓慢;")])])])]),t._v(" "),n("p",[t._v("看了上面两种 jsbundle 我们团队(ivweb)最终选择了"),n("strong",[t._v("jsbundle 部分内置,业务资源动态下发的方式")]),t._v("; 剩余的文章部分笔者将会一一介绍我们是如何优化 rn 的。")]),t._v(" "),n("h2",{attrs:{id:"二、性能优化问题分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、性能优化问题分析"}},[t._v("#")]),t._v(" 二、性能优化问题分析")]),t._v(" "),n("p",[t._v("回到上面讲的 "),n("strong",[t._v("jsbundle 部分内置,资源动态下发")]),t._v("的方式,我们简单介绍一下其整体的思路:")]),t._v(" "),n("ol",[n("li",[t._v("rn 框架启动")]),t._v(" "),n("li",[t._v("解析并执行公共 jsbundle, 并行下载业务 jsbundle;")]),t._v(" "),n("li",[t._v("解析并执行业务 jsbundle")])]),t._v(" "),n("p",[n("strong",[t._v("在不考虑优化 rn 框架的基础上")]),t._v(",我们得到下载业务 jsbundle 到页面渲染的大致耗时为:")]),t._v(" "),n("p",[n("img",{attrs:{src:a(702),alt:""}})]),t._v(" "),n("p",[t._v("很明显首屏耗时时间是非常长的;整体分析了 rn 的耗时时间,我们主要从如下几个方面考虑做性能优化:")]),t._v(" "),n("ol",[n("li",[n("strong",[t._v("优化 bundle 下载时间")]),t._v(": 由于数据的隐私性,暂时只能提供整体优化后的首屏时间: "),n("strong",[t._v("从 2046ms 到 1176ms")])]),t._v(" "),n("li",[n("strong",[t._v("优化 bundle 解析时间")])]),t._v(" "),n("li",[n("strong",[t._v("优化首屏数据")])])]),t._v(" "),n("h2",{attrs:{id:"三、bundle-下载时间优化-之-bundle-体积优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、bundle-下载时间优化-之-bundle-体积优化"}},[t._v("#")]),t._v(" 三、bundle 下载时间优化-之 bundle 体积优化")]),t._v(" "),n("h3",{attrs:{id:"_1-问题分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-问题分析"}},[t._v("#")]),t._v(" 1. 问题分析")]),t._v(" "),n("p",[t._v("经过一系列的统计数据我们得到 bundle 下载的时间和资源大小的关系:")]),t._v(" "),n("p",[n("img",{attrs:{src:a(703),alt:""}})]),t._v(" "),n("p",[n("strong",[t._v("说明: bundle 的下载时间和资源的大小是成正比关系")]),t._v("; 下面我们将具体探讨可以通过哪些方式优化 bundle 体积.")]),t._v(" "),n("p",[t._v("首先我们来分析一下一个 rn 的 bundle 由哪些部分组成: "),n("strong",[t._v("图片资源 + bundle")]),t._v(";")]),t._v(" "),n("p",[t._v("而一个 bundle 又由: "),n("strong",[t._v("全局变量声明+polyfill+模块定义+require")]),t._v("四部分组成")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// var声明层")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" __BUNDLE_START_TIME__"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nativePerformanceNow"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nativePerformanceNow")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("Date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("__DEV__"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("process"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("process"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_ENV")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"production"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//polyfill层")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("r")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"use strict"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("__r"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("o"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("__d")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("n")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" o"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("dependencyMap")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("factory")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("hasError")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("importedAll")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("importedDefault")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("isInitialized")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("publicModule")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("exports")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("o"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 模块定义层")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("__d")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("g"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("d")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("r")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("t"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("r")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("o"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("n")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("r")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("u"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("r")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AppRegistry"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerComponent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("u"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" o"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("402")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("403")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("__d")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("R")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("S")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("c")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("R")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ReactNativeSSR"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("displayName")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ReactNativeSSR"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("403")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// require层")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("__r")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("93")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("__r")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),n("p",[t._v("所以我们优化的思路大致有如下几个方向:")]),t._v(" "),n("ol",[n("li",[n("strong",[t._v("减少图片资源,图片地址 cdn 化")]),t._v(": 图片资源并非和 bundle 一起下发而是使用 cdn 的方式加载;")]),t._v(" "),n("li",[n("strong",[t._v("抽离公共包")]),t._v(": 将业务通用的资源/代码进行抽离,比如 react,react-native,redux,以及一些业务通用的包内置到 app; 这样上面介绍的 bundle 就不会存在"),n("strong",[t._v("var 声明层,polyfill 层,部分 modules")])]),t._v(" "),n("li",[n("strong",[t._v("module tree shaking")]),t._v(": 将无用的代码移除掉")]),t._v(" "),n("li",[n("strong",[t._v("module diff")]),t._v(": 将前后两次代码进行 diff 比较,只动态下发 diff 部分;")])]),t._v(" "),n("h3",{attrs:{id:"_2-减少图片资源-图片地址-cdn-化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-减少图片资源-图片地址-cdn-化"}},[t._v("#")]),t._v(" 2. 减少图片资源,图片地址 cdn 化")]),t._v(" "),n("blockquote",[n("p",[t._v("减少图片资源,图片地址 cdn 化的本质是: "),n("strong",[t._v("图片等资源无需内置到 app，采用线上加载的方式,从而减少整个下发包的体积")])])]),t._v(" "),n("p",[t._v("大家默认知道 rn 打包后的图片并不会进行 hash,所以减少图片资源,图片地址 cdn 化的前提是需要进行图片 hash.")]),t._v(" "),n("p",[t._v("这里推荐自己编写的一个 hash 库，结合 metro 进行使用: "),n("a",{attrs:{href:"https://github.com/MrGaoGang/react-native-file-hash-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("react-native-file-hash-plugin"),n("OutboundLink")],1),t._v(";")]),t._v(" "),n("p",[t._v("文件进行 hash 之后需要将图片地址从本地地址更换为远程地址:")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("Image"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resolveAssetSource"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCustomSourceTransformer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 资源的appName，构建的时候插入")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" imageAppName "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" resolver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asset "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" resolver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("appName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拿到app 对应的cdn地址")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" bundleRoot "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" global"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("imageAppName"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("_cdnUrl")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" resolveAsset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bundleRoot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    resolver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jsbundleUrl "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bundleRoot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Platform"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("OS")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"android"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      resolveAsset "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" resolver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("drawableFolderInBundle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      resolveAsset "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" resolver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("scaledAssetURLNearBundle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    resolveAsset "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" resolver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("defaultAsset")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" resolveAsset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h3",{attrs:{id:"_3-抽离公共包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-抽离公共包"}},[t._v("#")]),t._v(" 3. 抽离公共包")]),t._v(" "),n("p",[t._v("这块相信大家都做过,我们可以使用 metro 的"),n("code",[t._v("processModuleFilter")]),t._v("过滤掉哪些我们不需要打包到业务 bundle 的模块.")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" commonModules "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"react"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"react-native"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redux"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"自己的业务模块"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一个简单的例子")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("processModuleFilter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("module")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//过滤掉path为base-modules的一些模块（基础包内已有）")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("indexOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"base-modules"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//过滤掉node_modules内的一些通用模块（基础包内已有）")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ele "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" commonModules"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("indexOf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node_modules"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" ele"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//其他就是应用代码")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"_3-module-tree-shaking"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-module-tree-shaking"}},[t._v("#")]),t._v(" 3. module tree shaking")]),t._v(" "),n("p",[t._v("这块大家可以参考一下我之前写的另外一篇文章:"),n("a",{attrs:{href:"https://mrgaogang.github.io/react/ReactNative%E5%8D%83%E4%BA%BA%E5%8D%83%E9%9D%A2%E6%96%B9%E6%A1%88.html#_4-%E9%92%88%E5%AF%B9%E6%8C%87%E5%AE%9A%E7%9A%84-ab-%E5%AE%9E%E9%AA%8C%E4%BB%8E%E5%85%A5%E5%8F%A3%E8%BF%9B%E8%A1%8C%E5%85%A8%E5%B1%80%E6%9C%80%E5%B0%8F%E4%BE%9D%E8%B5%96%E5%88%86%E6%9E%90",target:"_blank",rel:"noopener noreferrer"}},[t._v("ReactNative 千人千面方案"),n("OutboundLink")],1),t._v(" 进行全局最小依赖分析，剔除无用模块;")]),t._v(" "),n("h3",{attrs:{id:"_4-module-diff"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-module-diff"}},[t._v("#")]),t._v(" 4. module diff")]),t._v(" "),n("p",[n("code",[t._v("module diff")]),t._v("的主要思路为必须前后两次构建的资源包，进行 module diff;这样下发 jsbundle 的时候只下发增量部分。这里一般主要和离线包进行配合使用,要考虑的有:")]),t._v(" "),n("ul",[n("li",[t._v("如何进行代码 diff?")]),t._v(" "),n("li",[t._v("离线包的代码如何和增量部分进行组装?")]),t._v(" "),n("li",[t._v("是否采用懒加载的方式加载 diff?")]),t._v(" "),n("li",[t._v("等")])]),t._v(" "),n("p",[t._v("这块要做的事情很多,但是的确是有用处的。")]),t._v(" "),n("h2",{attrs:{id:"四、bundle-下载时间优化-之-优化-http"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、bundle-下载时间优化-之-优化-http"}},[t._v("#")]),t._v(" 四、bundle 下载时间优化-之 优化 http")]),t._v(" "),n("p",[t._v("众所周知 http 从 1.0 逐步发展到 "),n("code",[t._v("http3.0")]),t._v(";中间也涌现出 "),n("code",[t._v("http2.0")]),t._v(" 这种使用支持多路复用的协议;但是 http2.0 并没有解决 TCP 的队头阻塞问题;这是由 TCP 协议所决定的。")]),t._v(" "),n("p",[t._v("所以为什么我们不能尝试使用 "),n("code",[t._v("http3.0")]),t._v(", "),n("code",[t._v("QUIC")]),t._v(" 协议去做下载呢?")]),t._v(" "),n("blockquote",[n("p",[t._v("QUIC（Quick UDP Internet Connections，读 quick）是由 Google 提出的一种基于 UDP 改进的低时延的互联网传输层.")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(704),alt:""}})]),t._v(" "),n("p",[t._v("QUIC 相比 http2.0 有如下优点:")]),t._v(" "),n("ul",[n("li",[t._v("支持 0-RTT 连接(最多 1-RTT)")]),t._v(" "),n("li",[t._v("用户域的拥塞控制，协议可快速部署、更新")]),t._v(" "),n("li",[t._v("UDP 天然无队头阻塞问题")]),t._v(" "),n("li",[t._v("连接迁移")]),t._v(" "),n("li",[t._v("前向纠错")])]),t._v(" "),n("p",[t._v("具体详细的使用可以查看: "),n("a",{attrs:{href:"https://mrgaogang.github.io/net/quic.html#quic-%E5%8D%8F%E8%AE%AE%E6%98%AF%E5%B9%B2%E5%98%9B%E7%9A%84",target:"_blank",rel:"noopener noreferrer"}},[t._v("QUIC 协议在 Android 和 iOS 的使用"),n("OutboundLink")],1)]),t._v(" "),n("h2",{attrs:{id:"五、优化-bundle-解析时间-并行加载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五、优化-bundle-解析时间-并行加载"}},[t._v("#")]),t._v(" 五、优化 bundle 解析时间 - 并行加载")]),t._v(" "),n("p",[t._v("看过我之前写的"),n("strong",[t._v("React Native 与 iOS 通信原理三部曲")])]),t._v(" "),n("ol",[n("li",[n("p",[n("a",{attrs:{href:"https://mrgaogang.github.io/react/ReactNative%E4%B8%8EiOS%E5%8E%9F%E7%94%9F%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90-%E5%88%9D%E5%A7%8B%E5%8C%96.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ReactNative 与 iOS 原生通信原理解析-初始化原理"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://mrgaogang.github.io/react/ReactNative%E4%B8%8EiOS%E5%8E%9F%E7%94%9F%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90-JS%E5%8A%A0%E8%BD%BD%E5%8F%8A%E6%89%A7%E8%A1%8C%E7%AF%87.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ReactNative 与 iOS 原生通信原理解析-JS 加载及执行篇"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://mrgaogang.github.io/react/ReactNative%E4%B8%8EiOS%E5%8E%9F%E7%94%9F%E9%80%9A%E4%BF%A1%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90-%E9%80%9A%E4%BF%A1%E7%AF%87.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ReactNative 与 iOS 原生通信原理解析-通信篇"),n("OutboundLink")],1)])])]),t._v(" "),n("p",[t._v("的同学应该大致清楚 rn 解析的整个流程,刨除对 rn 底层的改写,影响 bundle 解析的时间有:")]),t._v(" "),n("ul",[n("li",[t._v("jsbundle 的体积: 这块我们已经在上面优化过 bundle 的体积了")]),t._v(" "),n("li",[t._v("common/业务包加载的耗时;")])]),t._v(" "),n("p",[t._v("我们采用的方式是: "),n("strong",[t._v("应用启动开启独立线程加载 common 包,页面启动后并行加载 bundle 资源的方式")])]),t._v(" "),n("h2",{attrs:{id:"六、优化-bundle-解析时间-rn-单例-多例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#六、优化-bundle-解析时间-rn-单例-多例"}},[t._v("#")]),t._v(" 六、优化 bundle 解析时间 - RN 单例/多例")]),t._v(" "),n("h3",{attrs:{id:"单例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#单例"}},[t._v("#")]),t._v(" 单例")]),t._v(" "),n("p",[t._v("RN 的单例模式指的是: "),n("strong",[t._v("app 只会启动一个 rn 的实例，加载一次 common 包，多个业务包在同一个实例中运行")])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("单例模式的优点: 每个业务只会加载一次,若已经加载过则无需再次加载,内存消耗比较低;")])]),t._v(" "),n("li",[n("p",[t._v("单例模式的缺点: 其中一个比较重要的问题是"),n("strong",[t._v("如何做数据的隔离?")]),t._v(" 多个业务包如果修改同一个全局变量，势必会造成数据混乱；所以我们需要做数据隔离;")])])]),t._v(" "),n("p",[t._v("我们这边做单例模式下的数据隔离使用的方式是: "),n("strong",[t._v("使用 AST 改写一些全局变量")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(705),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"多例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多例"}},[t._v("#")]),t._v(" 多例")]),t._v(" "),n("p",[t._v("RN 的多例模式指的是: "),n("strong",[t._v("业务包每次都运行在一个单独的 RN 实例中,每次会单独的创建一个新的 RCTBridge")])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("多例模式的优点:天然的数据隔离")])]),t._v(" "),n("li",[n("p",[t._v("多例模式的缺点: 多次页面的加载造成不必要的内存消耗;")])])]),t._v(" "),n("h2",{attrs:{id:"性能优化-cgi-并行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#性能优化-cgi-并行"}},[t._v("#")]),t._v(" 性能优化-cgi 并行")]),t._v(" "),n("p",[t._v("这里的主要思路是: "),n("strong",[t._v("在下载 rn bundle 的时候,并行请求首屏数据")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(706),alt:""}})]),t._v(" "),n("p",[t._v("详细的实现方式需要根据业务的具体场景。")]),t._v(" "),n("h2",{attrs:{id:"其他性能优化-rn-相关技术"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#其他性能优化-rn-相关技术"}},[t._v("#")]),t._v(" 其他性能优化/rn 相关技术")]),t._v(" "),n("p",[t._v("还有很多其他的性能优化手段,本文就不一一列举了,有兴趣的同学可以尝试一下:")]),t._v(" "),n("ul",[n("li",[t._v("添加离线包")]),t._v(" "),n("li",[t._v("资源预加载")]),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/necolas/react-native-web",target:"_blank",rel:"noopener noreferrer"}},[t._v("rn 页面同构 h5,做降级处理"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://mrgaogang.github.io/react/ReactNative%E5%8D%83%E4%BA%BA%E5%8D%83%E9%9D%A2%E6%96%B9%E6%A1%88.html#%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80",target:"_blank",rel:"noopener noreferrer"}},[t._v("ReactNative 做 abtest"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://mrgaogang.github.io/react/ReactNative%E6%95%B0%E6%8D%AE%E7%9B%B4%E5%87%BA%E6%96%B9%E6%A1%88.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ReactNative 做 数据直出"),n("OutboundLink")],1)])]),t._v(" "),n("h2",{attrs:{id:"最后"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#最后"}},[t._v("#")]),t._v(" 最后")]),t._v(" "),n("p",[t._v("肯定会有同学有疑问，为啥我们不做rn的底层优化？ 我们的主要考虑是:"),n("strong",[t._v("升级迭代的问题")]),t._v(",通过我们的动态化方案，rn的升级变得没有那么困难,并且rn官方也一直致力于底层的优化。何不站在巨人的肩膀上呢？")])])}),[],!1,null,null,null);s.default=r.exports}}]);