(window.webpackJsonp=window.webpackJsonp||[]).push([[187],{868:function(s,a,t){"use strict";t.r(a);var e=t(18),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"使用-docker-进行-mysql-主从复制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-进行-mysql-主从复制"}},[s._v("#")]),s._v(" 使用 Docker 进行 MySQL 主从复制")]),s._v(" "),t("h2",{attrs:{id:"为什么要主从复制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么要主从复制"}},[s._v("#")]),s._v(" 为什么要主从复制")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("做数据的热备")])]),s._v(" "),t("li",[t("p",[s._v("如果主数据库宕机，可以快速将业务系统切换到从数据库上，可避免数据丢失。")])]),s._v(" "),t("li",[t("p",[s._v("业务量越来越大，I/O 访问频率过高，单机无法满足，此时做多库的存储，降低磁盘 I/O 访问的频率，提高单个机器的 I/O 性能。如果对数据库的读和写都在同一个数据库服务器中操作，业务系统性能会降低。")])]),s._v(" "),t("li",[t("p",[s._v("在业务复杂的系统中，有这么一个情景，有一句 sql 语句需要锁表，导致暂时不能使用读的服务，那么就很影响运行中的业务，使用主从复制，让主库负责写，从库负责读，这样，即使主库出现了锁表的情景，通过读从库也可以保证业务的正常运作。通过做主从复制（读写分离）来减轻主数据库的负载。")])])]),s._v(" "),t("h2",{attrs:{id:"原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[s._v("#")]),s._v(" 原理")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/11/29/1675d56c0e575a97~tplv-t2oaga2asx-watermark.awebp",alt:""}})]),s._v(" "),t("blockquote",[t("ul",[t("li",[s._v("步骤一：主库db的更新事件(update、insert、delete)被写到binlog")]),s._v(" "),t("li",[s._v("步骤二：从库发起连接，连接到主库")]),s._v(" "),t("li",[s._v("步骤三：此时主库创建一个binlog dump thread，把binlog的内容发送到从库")]),s._v(" "),t("li",[s._v("步骤四：从库启动之后，创建一个I/O线程，读取主库传过来的binlog内容并写入到relay log")]),s._v(" "),t("li",[s._v("步骤五：还会创建一个SQL线程，从relay log里面读取内容，从"),t("strong",[s._v("Exec_Master_Log_Pos")]),s._v("位置开始执行读取到的更新事件，将更新内容写入到slave的db")])])]),s._v(" "),t("p",[s._v("注：上面的解释是解释每一步做了什么，整个mysql主从复制是异步的，不是按照上面的步骤执行的。")]),s._v(" "),t("p",[s._v("同步操作通过 3 个线程实现，其基本步骤如下：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("主服务器将数据的更新记录到二进制日志中（记录被称作二进制日志事件）-- 主库线程；\n从库将主库的二进制日志复制到本地的中继日志（relay log）-- 从库 I/O 线程；\n从库读取中继日志中的事件，将其重放到数据中 -- 从库 SQL 线程。\n")])])]),t("h2",{attrs:{id:"主实例搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主实例搭建"}},[s._v("#")]),s._v(" 主实例搭建")]),s._v(" "),t("ul",[t("li",[s._v("运行 mysql 主实例：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3307")]),s._v(":3306 --name mysql-master "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /your_absolute_project_path/mysql-master/log:/var/log/mysql "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /your_absolute_project_path/mysql-master/data:/var/lib/mysql "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /your_absolute_project_path/mysql-master/conf:/etc/mysql "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-dit mysql:5.7\n\n")])])]),t("ul",[t("li",[s._v("在 mysql 的配置文件夹"),t("code",[s._v("/your_absolute_project_path/mysql-master/conf")]),s._v("中创建一个配置文件"),t("code",[s._v("my.cnf")]),s._v("：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" my.cnf\n\n")])])]),t("ul",[t("li",[s._v("修改配置文件 my.cnf，配置信息如下：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 设置server_id，同一局域网中需要唯一")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server_id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 指定不需要同步的数据库名称")]),s._v("\nbinlog-ignore-db"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 开启二进制日志功能")]),s._v("\nlog-bin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mall-mysql-bin\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 设置二进制日志使用内存大小（事务）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("binlog_cache_size")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1M\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 设置使用的二进制日志格式（mixed,statement,row）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("binlog_format")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mixed\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 二进制日志过期清理时间。默认值为0，表示不自动清理。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("expire_logs_days")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("slave_skip_errors")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1062")]),s._v("\n\n")])])]),t("ul",[t("li",[s._v("修改完配置后重启实例：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" restart mysql-master\n\n")])])]),t("ul",[t("li",[s._v("进入"),t("code",[s._v("mysql-master")]),s._v("容器中：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it mysql-master /bin/bash\n\n")])])]),t("ul",[t("li",[s._v("在容器中使用 mysql 的登录命令连接到客户端：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysql -uroot -proot\n\n")])])]),t("ul",[t("li",[s._v("创建数据同步用户：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("CREATE "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave-one'")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" IDENTIFIED BY "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nGRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave-one'")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nflush privileges"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h2",{attrs:{id:"从实例搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从实例搭建"}},[s._v("#")]),s._v(" 从实例搭建")]),s._v(" "),t("ul",[t("li",[s._v("运行 mysql 从实例：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3308")]),s._v(":3306 --name mysql-slave "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /your_absolute_project_path/mysql-slave/log:/var/log/mysql "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /your_absolute_project_path/mysql-slave/data:/var/lib/mysql "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /your_absolute_project_path/mysql-slave/conf:/etc/mysql "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-dit mysql:5.7\n\n")])])]),t("ul",[t("li",[s._v("在 mysql 的配置文件夹"),t("code",[s._v("/your_absolute_project_path/mysql-slave/conf")]),s._v("中创建一个配置文件"),t("code",[s._v("my.cnf")]),s._v("：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" my.cnf\n\n")])])]),t("ul",[t("li",[s._v("修改配置文件 my.cnf：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 设置server_id，同一局域网中需要唯一")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("server_id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 指定不需要同步的数据库名称")]),s._v("\nbinlog-ignore-db"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 开启二进制日志功能，以备Slave作为其它数据库实例的Master时使用")]),s._v("\nlog-bin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mall-mysql-slave1-bin\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 设置二进制日志使用内存大小（事务）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("binlog_cache_size")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1M\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 设置使用的二进制日志格式（mixed,statement,row）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("binlog_format")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mixed\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 二进制日志过期清理时间。默认值为0，表示不自动清理。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("expire_logs_days")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("slave_skip_errors")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1062")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## relay_log配置中继日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("relay_log")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mall-mysql-relay-bin\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## log_slave_updates表示slave将复制事件写进自己的二进制日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("log_slave_updates")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## slave设置为只读（具有super权限的用户除外）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("read_only")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n")])])]),t("ul",[t("li",[s._v("修改完配置后重启实例：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" restart mysql-slave\n\n")])])]),t("h2",{attrs:{id:"将主从数据库进行连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#将主从数据库进行连接"}},[s._v("#")]),s._v(" 将主从数据库进行连接")]),s._v(" "),t("ul",[t("li",[s._v("连接到主数据库的 mysql 客户端，查看主数据库状态：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("show master status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])])]),t("ul",[t("li",[s._v("主数据库状态显示如下：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show master status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+-----------------------+----------+--------------+------------------+-------------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" File                  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Position "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Binlog_Do_DB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Binlog_Ignore_DB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Executed_Gtid_Set "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------------------+----------+--------------+------------------+-------------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mall-mysql-bin.000001 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-----------------------+----------+--------------+------------------+-------------------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("ul",[t("li",[s._v("进入"),t("code",[s._v("mysql-slave")]),s._v("容器中：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it mysql-slave /bin/bash\n\n")])])]),t("ul",[t("li",[s._v("在容器中使用 mysql 的登录命令连接到客户端：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysql -uroot -proot\n\n")])])]),t("ul",[t("li",[s._v("在从数据库中配置主从复制：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 记得切换自己的ip以及端口和log_file")]),s._v("\nchange master to "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("master_host")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.64.67.71'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("master_user")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave-one'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("master_password")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("master_port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3307")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("master_log_file")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mall-mysql-bin.000001'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("master_log_pos")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("master_connect_retry")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])])]),t("ul",[t("li",[t("p",[s._v("主从复制命令参数说明：")]),s._v(" "),t("ul",[t("li",[s._v("master_host：主数据库的 IP 地址；")]),s._v(" "),t("li",[s._v("master_port：主数据库的运行端口；")]),s._v(" "),t("li",[s._v("master_user：在主数据库创建的用于同步数据的用户账号；")]),s._v(" "),t("li",[s._v("master_password：在主数据库创建的用于同步数据的用户密码；")]),s._v(" "),t("li",[s._v("master_log_file：指定从数据库要复制数据的日志文件，通过查看主数据的状态，获取 File 参数；")]),s._v(" "),t("li",[s._v("master_log_pos：指定从数据库从哪个位置开始复制数据，通过查看主数据的状态，获取 Position 参数；")]),s._v(" "),t("li",[s._v("master_connect_retry：连接失败重试的时间间隔，单位为秒。")])])]),s._v(" "),t("li",[t("p",[s._v("查看主从同步状态：")])])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("show slave status "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("G"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])])]),t("ul",[t("li",[s._v("从数据库状态显示如下：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show slave status "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("G"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n*************************** "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". row ***************************\n               Slave_IO_State:\n                  Master_Host: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.64")]),s._v(".67.71\n                  Master_User: slave\n                  Master_Port: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3307")]),s._v("\n                Connect_Retry: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n              Master_Log_File: mall-mysql-bin.000001\n          Read_Master_Log_Pos: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v("\n               Relay_Log_File: b72cade3208a-relay-bin.000001\n                Relay_Log_Pos: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n        Relay_Master_Log_File: mall-mysql-bin.000001\n             Slave_IO_Running: No "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示还没有开启同步")]),s._v("\n            Slave_SQL_Running: No "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示还没有开启同步")]),s._v("\n              Replicate_Do_DB:\n          Replicate_Ignore_DB:\n           Replicate_Do_Table:\n       Replicate_Ignore_Table:\n      Replicate_Wild_Do_Table:\n  Replicate_Wild_Ignore_Table:\n                   Last_Errno: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n                   Last_Error:\n                 Skip_Counter: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n          Exec_Master_Log_Pos: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v("\n              Relay_Log_Space: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("154")]),s._v("\n              Until_Condition: None\n               Until_Log_File:\n                Until_Log_Pos: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n           Master_SSL_Allowed: No\n           Master_SSL_CA_File:\n           Master_SSL_CA_Path:\n              Master_SSL_Cert:\n            Master_SSL_Cipher:\n               Master_SSL_Key:\n        Seconds_Behind_Master: NULL\nMaster_SSL_Verify_Server_Cert: No\n                Last_IO_Errno: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n                Last_IO_Error:\n               Last_SQL_Errno: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n               Last_SQL_Error:\n  Replicate_Ignore_Server_Ids:\n             Master_Server_Id: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n                  Master_UUID:\n             Master_Info_File: /var/lib/mysql/master.info\n                    SQL_Delay: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n          SQL_Remaining_Delay: NULL\n      Slave_SQL_Running_State:\n           Master_Retry_Count: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v("\n                  Master_Bind:\n      Last_IO_Error_Timestamp:\n     Last_SQL_Error_Timestamp:\n               Master_SSL_Crl:\n           Master_SSL_Crlpath:\n           Retrieved_Gtid_Set:\n            Executed_Gtid_Set:\n                Auto_Position: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n         Replicate_Rewrite_DB:\n                 Channel_Name:\n           Master_TLS_Version:\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("ul",[t("li",[s._v("开启主从同步：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("start slave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭主从使用stop slave;")]),s._v("\n")])])]),t("ul",[t("li",[s._v("查看从数据库状态发现已经同步：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show slave status "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("G"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n*************************** "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". row ***************************\n               Slave_IO_State: Waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" master to send event\n                  Master_Host: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.64")]),s._v(".67.71\n                  Master_User: slave-one\n                  Master_Port: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3307")]),s._v("\n                Connect_Retry: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n              Master_Log_File: mall-mysql-bin.000001\n          Read_Master_Log_Pos: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("936")]),s._v("\n               Relay_Log_File: b72cade3208a-relay-bin.000002\n                Relay_Log_Pos: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("484")]),s._v("\n        Relay_Master_Log_File: mall-mysql-bin.000001\n             Slave_IO_Running: Yes "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示已经开启同步了")]),s._v("\n            Slave_SQL_Running: Yes\n              Replicate_Do_DB:\n          Replicate_Ignore_DB:\n           Replicate_Do_Table:\n       Replicate_Ignore_Table:\n      Replicate_Wild_Do_Table:\n  Replicate_Wild_Ignore_Table:\n                   Last_Errno: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n                   Last_Error:\n                 Skip_Counter: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n          Exec_Master_Log_Pos: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("936")]),s._v("\n              Relay_Log_Space: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("698")]),s._v("\n              Until_Condition: None\n               Until_Log_File:\n                Until_Log_Pos: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n           Master_SSL_Allowed: No\n           Master_SSL_CA_File:\n           Master_SSL_CA_Path:\n              Master_SSL_Cert:\n            Master_SSL_Cipher:\n               Master_SSL_Key:\n        Seconds_Behind_Master: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nMaster_SSL_Verify_Server_Cert: No\n                Last_IO_Errno: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n                Last_IO_Error:\n               Last_SQL_Errno: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n               Last_SQL_Error:\n  Replicate_Ignore_Server_Ids:\n             Master_Server_Id: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v("\n                  Master_UUID: 9d05ada9-03e7-11ec-b838-0242ac110003\n             Master_Info_File: /var/lib/mysql/master.info\n                    SQL_Delay: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n          SQL_Remaining_Delay: NULL\n      Slave_SQL_Running_State: Slave has "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" all relay log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" updates\n           Master_Retry_Count: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v("\n                  Master_Bind:\n      Last_IO_Error_Timestamp:\n     Last_SQL_Error_Timestamp:\n               Master_SSL_Crl:\n           Master_SSL_Crlpath:\n           Retrieved_Gtid_Set:\n            Executed_Gtid_Set:\n                Auto_Position: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n         Replicate_Rewrite_DB:\n                 Channel_Name:\n           Master_TLS_Version:\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])])]),t("h2",{attrs:{id:"主从复制测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主从复制测试"}},[s._v("#")]),s._v(" 主从复制测试")]),s._v(" "),t("blockquote",[t("p",[s._v("主从复制的测试方法有很多，可以在主实例中创建一个数据库，看看从实例中是否有该数据库，如果有，表示主从复制已经搭建成功。")])]),s._v(" "),t("ul",[t("li",[s._v("在主实例中创建一个数据库"),t("code",[s._v("mall")]),s._v("；")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/14/16fa3e67526344a5~tplv-t2oaga2asx-watermark.awebp",alt:""}})]),s._v(" "),t("ul",[t("li",[s._v("在从实例中查看数据库，发现也有一个"),t("code",[s._v("mall")]),s._v("数据库，可以判断主从复制已经搭建成功。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/14/16fa3e6752765249~tplv-t2oaga2asx-watermark.awebp",alt:""}})]),s._v(" "),t("ul",[t("li",[s._v("在主数据库中创建一个表")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" use mall"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nDatabase changed\nmysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" CREATE TABLE IF NOT EXISTS "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("runoob_tbl"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("runoob_id"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" INT UNSIGNED AUTO_INCREMENT,\n    -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("runoob_title"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" VARCHAR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" NOT NULL,\n    -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("runoob_author"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" VARCHAR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" NOT NULL,\n    -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("submission_date"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" DATE,\n    -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    PRIMARY KEY "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("runoob_id"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("ENGINE"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("InnoDB DEFAULT "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CHARSET")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" rows affected "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.04")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("ul",[t("li",[s._v("在从数据库中查看")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show tables"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+----------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Tables_in_mall "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----------------+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" runoob_tbl     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----------------+\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h2",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://juejin.cn/post/6844903726944092167",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL的主从复制"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=n.exports}}]);